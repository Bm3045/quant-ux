"use strict";(self["webpackChunkquant_ux"]=self["webpackChunkquant_ux"]||[]).push([[598],{63738:function(e,t,s){s.r(t),s.d(t,{default:function(){return ct}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasPage",attrs:{id:"CanvasNode"}},[s("AnalyticToolbar",{ref:"toolbar"}),s("AnalyticCanvas",{ref:"canvas"})],1)},o=[],n=s(67906),a=s(16198),r=(s(41539),s(78783),s(33948),s(60245)),l=s(28379),h=s(78651),c=s(24246),d=s(9723),u=s(59344),g=s(48039),v=s(77259),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbar MatcAnalyticsToolbar"},[s("div",{staticClass:"MatcToolbarTop "},[s("HomeMenu",{on:{select:e.onHomeMenu}}),s("div",{staticClass:"MatcToolbarTopCntr"},[s("div",{staticClass:"MatcToolbarTopLeftCntr MatcToolbarSection",attrs:{"data-dojo-attach-point":"screenSection"}}),s("div",{staticClass:"MatcToolbarNotificationSection MatcToolbarSection",attrs:{"data-dojo-attach-point":"notificationSection"}},[s("ToolbarPluginSection",{attrs:{events:e.events,user:e.user,mode:e.model}}),s("ViewConfig",{attrs:{value:e.canvasViewConfig,analytic:!0},on:{change:e.onChangeCanvasViewConfig}}),e._e()],1)])],1),s("div",{staticClass:"MatcToobarPropertiesSection MatcToolbarSectionHidden",attrs:{"data-dojo-attach-point":"propertiesCntr"}}),e._m(0)])},p=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:" MatcToobarCommentSection MatcToolbarSection"},[s("a",{staticClass:"MatcToolbarItem",attrs:{"data-dojo-attach-point":"commentBtn"}},[s("span",{staticClass:"mdi mdi-comment-outline"})])])}],f=(s(21249),s(68309),s(2707),s(54747),s(75790)),M=s(54953),C=s(72712),w=s(79109),y=s(54524),S=s(17386),b=s(6848),k=s(96200),Z=s(43788),T=s(71021),D=s(17448),_=s(86639),x=s(87070),L=s(26186),B=s(96686),O=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcDashHistogram"})},P=[],W=(s(74916),s(23123),s(43371)),A={name:"Histogram",mixins:[w.Z,Z.Z,r.Z],data:function(){return{x_prefix:""}},components:{},methods:{postCreate:function(){if(this.log=new y.Z("Histogram"),this.counts){var e=this.counts.split(","),t=new W.Z(e),s=t.hist(null,this.bins);this.setValue(s,t.mean())}},setPopoverFct:function(e){this.popoverLabelFct=e},setLabel:function(e){this.label.innerHTML=e},setMaxMin:function(e){this.minMaxFct=e},setFormTo:function(e){this.toFromFct=e},onHover:function(e){this.hoverFCT=e},setValue:function(e,t){var s=e.size(),i=e.max("count"),o=e.min("count"),n=e.min("from"),a=e.max("to"),r=100/(2*s-1),h=(t-n)/(a-n),c=new S.Z,d=c.div("MatcDashHistogramCntr").build(),u=this;if(e.foreach((function(e,t){var s=e.count,o=c.div("MatcDashHistogramBar").build(d);if(o.style.height=Math.max(1,100*s/i)+"%",o.style.width=r+"%",o.style.left=r*(2*t)+"%",u.hoverFCT){var n=u.hoverFCT(e);l.Z.add(o,"MatcDashHistogramBarHover"),u.addTooltip(o,n)}})),this.toFromFct&&(a=this.toFromFct(a),n=this.toFromFct(n)),c.span("MatcDashHistogramLabelMax MatcDashHistogramLabel",i).build(d),c.span("MatcDashHistogramLabelMin MatcDashHistogramLabel",o).build(d),c.span("MatcDashHistogramLabelFrom MatcDashHistogramLabel",n+this.x_prefix).build(d),c.span("MatcDashHistogramLabelTo MatcDashHistogramLabel",a+this.x_prefix).build(d),this.domNode.innerHTML,this.domNode.appendChild(d),null!=t&&void 0!=t){var g=c.div("MatcDashHistogramLabelMean").build(d);g.style.left=100*h+"%",this.toFromFct&&(t=this.toFromFct(t)),c.span("MatcDashHistogramLabel MatcHorizontalMiddle",t+this.x_prefix).build(g);var v=c.div("MatcDashHistogramBarMean").build(d);v.style.left=100*h+"%"}}},mounted:function(){}},H=A,E=s(1001),V=(0,E.Z)(H,O,P,!1,null,null,null),R=V.exports,N=s(3270),F=s(80693),U=s(15804),G=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbarSection"})},I=[],$={name:"PluginSection",props:["user","model","events"],mixins:[],data:function(){return{value:null}},components:{},methods:{},mounted:function(){}},z=$,j=(0,E.Z)(z,G,I,!1,null,null,null),J=j.exports,K=s(65822),q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:" MatcToolbarArrowDropDown MatcToolbarDropDownButton MatcToobarHomeSection MatcToobarHomeSectionBlueX"},[e._m(0),s("div",{staticClass:"MatcToolbarPopUp MatcToolbarDropDownButtonPopup",attrs:{role:"menu","data-dojo-attach-point":"popup"},on:{mousedown:function(e){e.stopPropagation()}}},[s("div",{staticClass:"MatcToolbarPopUpWrapper"},[s("ul",{attrs:{role:"menu"}},e._l(e.items,(function(t){return s("li",{key:t.value,staticClass:"MatcToolbarMenuItem",class:t.css,on:{click:function(s){return s.stopPropagation(),e.onSelect(t,s)}}},[s("label",{staticClass:"MatcToolbarPopUpLabel"},[e._v(e._s(t.label))])])})),0)]),e._m(1)])])},X=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"MatcToolbarItem MatcToolbarPrimaryItem",attrs:{type:"button","data-dojo-attach-point":"button"}},[i("img",{attrs:{src:s(96075)}}),i("span",{staticClass:"caret"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcToolbarPopUpArrowCntr"},[s("div",{staticClass:"MatcToolbarPopUpArrow"})])}],Q=s(28258),Y={name:"CreateBasicButton",mixins:[C.Z,r.Z,Q.Z],data:function(){return{selectedTool:null,tools:[{value:"onShowSettings",icon:"",label:this.getNLS("toolbar.menu.settings")},{value:3,css:"MatcToolbarPopUpLine"},{value:"onExit",icon:"",label:this.getNLS("toolbar.menu.exit")}]}},computed:{items:function(){return this.tools}},components:{},methods:{onSelect:function(e,t){this.$emit("select",e,t)},onHide:function(){l.Z.remove(this.domNode,"MatcToolbarItemActive"),this.selectedTool=null},init:function(){return(0,a.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}},mounted:function(){}},ee=Y,te=(0,E.Z)(ee,q,X,!1,null,null,null),se=te.exports,ie={name:"AnalyticToolbar",mixins:[C.Z,w.Z,Z.Z,r.Z],data:function(){return{events:null,model:null,user:null,value:!1,analyticMode:"HeatmapClick",analyticHeatMapClicks:-1,canvasViewConfig:{}}},components:{ViewConfig:U.Z,HelpButton:K.Z,ToolbarPluginSection:J,HomeMenu:se},methods:{postCreate:function(){this.logger=new y.Z("AnalyticToolbar"),this.logger.log(2,"constructor","entry"),this.own((0,g.Z)(this.commentBtn,f.Z.press,u.Z.hitch(this,"onNewComment"))),this.own((0,g.Z)(this.signupSection,f.Z.press,u.Z.hitch(this,"showSignUpDialog"))),this.renderToolbar()},showHelpDialog:function(e){this.$refs.helpBtn&&this.$refs.helpBtn.show("analytics.canvas",e)},onHomeMenu:function(e,t){this.logger.log(-1,"onHomeMenu","entry",t),this[e.value]&&this[e.value](t)},onNewComment:function(e){this.logger.log(2,"onNewComment","entry"),this.stopEvent(e),this.emit("newComment",{type:"comment",event:e})},setAnalyticMode:function(e,t){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.canvas&&this.canvas.setAnalyticMode(e,t),this.hideProperties()},setModelService:function(e){this.modelService=e,setTimeout(u.Z.hitch(this,"initMouseData"),500)},setPublic:function(e){this.isPublic=e},setCanvasViewConfig:function(e){this.canvasViewConfig=e},onChangeCanvasViewConfig:function(e,t){this.canvas&&this.canvas.setCanvasViewConfig(e,t)},setUser:function(e){this.user=e},initMouseData:function(){var e=this;return(0,a.Z)((0,n.Z)().mark((function t(){var s,i;return(0,n.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.logger.log(2,"initMouseData","entry"),!e.isPublic){t.next=8;break}return t.next=4,e.modelService.findPublicMouse(e.model.id);case 4:s=t.sent,e.setMouseData(s),t.next=12;break;case 8:return t.next=10,e.modelService.findMouse(e.model.id);case 10:i=t.sent,e.setMouseData(i);case 12:case"end":return t.stop()}}),t)})))()},setMouseData:function(e){this.logger.log(2,"setMouseData","entry >"+e.length),this.mouseData=e},showClickHeatMap:function(){this.logger.log(2,"showClickHeatMap","entry > "+this.analyticHeatMapClicks),this.setSelectedViewButton(this.viewBtnClickMap),this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks}),this.showHeatMapProperties()},reShowClickHeatMap:function(){this.logger.log(0,"reShowClickHeatMap","entry > "+this.analyticHeatMapClicks),this.hideAllSections(),this.showHeatMapProperties()},showFirstClickHeatMap:function(e){this.logger.log(0,"showFirstClickHeatMap","entry > "+e),this.analyticHeatMapClicks=e,this.setHeatMapLabel(e),this.setAnalyticMode("HeatmapClick",{numberOfClicks:this.analyticHeatMapClicks})},showMouseHeatMap:function(){this.logger.log(2,"showMouseHeatMap","entry"),this.setSelectedViewButton(this.viewBtnMouseMap),this.mouseData?(this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse")):(this.canvas.showHint("Loading data..."),this.isPublic?this._doGet("/examples/mouse/"+this.model.id+".json",u.Z.hitch(this,"_onMouseDataLoaded")):this._doGet("rest/mouse/"+this.model.id+".json",u.Z.hitch(this,"_onMouseDataLoaded")))},_onMouseDataLoaded:function(e){this.logger.log(2,"_onMouseDataLoaded","entry >"+e.length),this.mouseData=e,this.canvas.setMouseData(this.mouseData),this.setAnalyticMode("HeatmapMouse")},showScrollHeatMap:function(){this.logger.log(2,"showScrollHeatMap","entry"),this.setSelectedViewButton(this.viewBtnScrollMap),this.setAnalyticMode("HeatmapScrollView")},showDwelTimeMap:function(){this.logger.log(2,"showDwelTimeMap","entry"),this.setSelectedViewButton(this.viewBtnDwellTime),this.setAnalyticMode("HeatmapDwelTime")},showDiscoveryTimeMap:function(){this.logger.log(2,"showDwelTimeMap","entry"),this.setSelectedViewButton(this.viewBtnDiscoveryTime),this.setAnalyticMode("HeatmapDiscoryTime")},showScrollTimeMap:function(){this.logger.log(2,"showScrollHeatMap","entry"),this.setSelectedViewButton(this.viewBtnScrollTime),this.setAnalyticMode("HeatmapScrollTime")},showViewMap:function(){this.logger.log(2,"showViewMap","entry"),this.setSelectedViewButton(this.viewBtnView),this.setAnalyticMode("HeatmapViews")},showDropOff:function(){this.logger.log(-1,"showDropOff","entry"),this.setSelectedViewButton(this.viewBtnDropOff),this.showDropOffProperties()},showUserJourney:function(){this.logger.log(-1,"showUserJourney","entry > "),this.setSelectedViewButton(this.viewBtnClickStream);var e={};for(var t in this.sessionCheckBoxes)e[t]=this.sessionCheckBoxes[t].getValue();var s={sessions:e,time:this.sessionTimeCheckBox.getValue(),color:this.sessionLineColor.getValue(),tree:this.sessionTreeCheckBox.getValue(),task:this.sessionTaskBtn.getValue(),taskColor:this.sessionTaskLineColor.getValue(),outlier:this.sessionOutlierCheckbox.getValue(),outlierColor:this.sessionOutlierColor.getValue()};this.setAnalyticMode("UserJourney",s),this.showSessionProperties()},showGestureMap:function(){this.logger.log(2,"showGestureMap","entry > "),this.setSelectedViewButton(this.viewBtnGesture);var e={color:this.gestureLineColor.getValue()};this.setAnalyticMode("Gesture",e),this.showGestureProperties()},renderToolbar:function(){this.logger.log(3,"renderToolbar","enter"),this.isRendered||(this.viewBtns=[],this.isRendered=!0,this.viewBtnClickMap=this.createToolBarItem("Click Heatmap","showClickHeatMap","mdi mdi-cursor-default",this.screenSection),this.viewBtns.push(this.viewBtnClickMap),this.addTooltip(this.viewBtnClickMap,"Where did the users click?"),this.viewBtnMouseMap=this.createToolBarItem("Mouse Heatmap","showMouseHeatMap","mdi mdi-mouse",this.screenSection),this.viewBtns.push(this.viewBtnMouseMap),this.addTooltip(this.viewBtnMouseMap,"Howlong was cursor at some place?"),this.viewBtnClickStream=this.createToolBarItem("User Journey","showUserJourney","mdi mdi-vector-polyline",this.screenSection),this.viewBtns.push(this.viewBtnClickStream),this.addTooltip(this.viewBtnClickStream,"See where the users have clicked in one session."),this.viewBtnDropOff=this.createToolBarItem("Tasks & Drop Off","showDropOff","mdi mdi-chart-timeline-variant-shimmer",this.screenSection),this.viewBtns.push(this.viewBtnDropOff),this.addTooltip(this.viewBtnDropOff,"See whre users dropped of when performing tasks."),this.viewBtnView=this.createToolBarItem("Views","showViewMap","mdi mdi-eye",this.screenSection),this.viewBtns.push(this.viewBtnView),this.addTooltip(this.viewBtnView,"How often was the screen loaded"),this.viewBtnDwellTime=this.createToolBarItem("Dwell Time","showDwelTimeMap","mdi mdi-timelapse",this.screenSection),this.viewBtns.push(this.viewBtnDwellTime),this.addTooltip(this.viewBtnDwellTime,"How much time have the users spend on this page in average"),this.viewBtnScrollMap=this.createToolBarItem("Scroll Visibility","showScrollHeatMap","mdi mdi-swap-vertical",this.screenSection),this.viewBtns.push(this.viewBtnScrollMap),this.addTooltip(this.viewBtnScrollMap,"How often was the part of the screen visible"),this.viewBtnScrollTime=this.createToolBarItem("Scroll Time","showScrollTimeMap","mdi mdi-timer",this.screenSection),this.viewBtns.push(this.viewBtnScrollTime),this.addTooltip(this.viewBtnScrollTime,"How long was the part of the screen visible"),this.setSelectedViewButton(this.viewBtnClickMap),this.logger.log(3,"renderToolbar","exit"))},render:function(){this.logger.log(3,"render","entry"),this.properties=document.createElement("div"),l.Z.add(this.properties,"MatcToobarPropertiesSectionCntr"),this.sections=[],this.propertiesStates={},this.renderScreenProperties(),this.renderWidgetProperties(),this.renderSessionProperties(),this.renderDropOffProperties(),this.renderHeatMapProperties(),this.renderGestureProperties(),this.propertiesCntr.appendChild(this.properties),this.scroller=this.$new(b.Z),this.scroller.placeAt(this.propertiesCntr),this.scroller.wrap(this.properties,40),this.hideAllSections(),this.showHeatMapProperties(),this.logger.log(3,"render","exit")},renderScreenProperties:function(){this.logger.log(3,"renderScreenProperties","entry");var e=new S.Z;this.screenNameDiv=this.createSection("Screen Name");var t=this.createContent(this.screenNameDiv);this.screenName=this.createInput(t,"Screen Name"),this.screenName.readOnly=!0;var s=e.div("MatcCenter").build(t),i=e.div("MatcMarginBottom").build(s);this.screenTestRing=this.createRing("Test Coverage","analytics.canvas.kpi.coverage"),this.screenTestRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenDwellRing=this.createRing("Dwell Time","analytics.canvas.kpi.dwell"),this.screenDwellRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenTotalViewRing=this.createRing("Screen Views","analytics.canvas.kpi.screen-views"),this.screenTotalViewRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenClickRing=this.createRing("Screen Clicks","analytics.canvas.kpi.screen-clicks"),this.screenClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.screenWidgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.screen-widget-clicks"),this.screenWidgetClickRing.placeAt(i)},renderWidgetProperties:function(){this.logger.log(3,"renderWidgetProperties","entry");var e=new S.Z;this.widgetNameDiv=this.createSection("Widget ");var t=this.createContent(this.widgetNameDiv);this.widgetName=this.createInput(t,"Screen"),this.widgetName.readOnly=!0;var s=e.div("MatcCenter").build(t),i=e.div("MatcMarginBottom").build(s);this.widgetClickRing=this.createRing("Widget Clicks","analytics.canvas.kpi.clicks"),this.widgetClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s),this.widgetFirstClickRing=this.createRing("First Clicks","analytics.canvas.kpi.first-clicks"),this.widgetFirstClickRing.placeAt(i),i=e.div("MatcMarginBottom").build(s);var o=this.createBigNumber(e,i,"Time before Click","analytics.canvas.kpi.before-click");this.widgetDiscoverLabel=o[0],this.widgetDiscoverSTDLabel=o[1]},renderHeatMapProperties:function(){this.logger.log(1,"renderHeatMapProperties","entry");var e=new S.Z;this.heatmapDiv=this.createSection("Heatmap");var t=this.createContent(this.heatmapDiv),s=e.div("MatcToobarRow MatcMarginBottom").build(t),i=this.$new(D.Z);l.Z.add(i.domNode,"MatcToolbarRadioList"),i.setOptions([{value:-1,label:"All Clicks"},{value:1,label:"First Click"},{value:3,label:"First three Clicks"},{value:"missedClicks",label:"Missed Clicks"}]),i.placeAt(e.div().build(s)),this.own(i.on("change",u.Z.hitch(this,"showFirstClickHeatMap"))),this.heatmapLabel=e.div("MatcToobarRow").label("MatcToolbarLabel MatcToolbarHelpSection").build(t),this.heatmapClickList=i,this.setHeatMapLabel(-1)},setHeatMapLabel:function(e){var t="";-1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintAll")),1===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirst")),3===e&&(t=this.getNLS("analytics.canvas.heatamp.hintFirstThree")),"missedClicks"===e&&(t=this.getNLS("analytics.canvas.heatamp.hintMissed")),this.heatmapLabel.textContent=t},renderDropOffProperties:function(){this.logger.log(2,"renderSessionProperties","entry");var e=new S.Z;this.dropOffConfigDiv=this.createSection("Show");var t=this.createContent(this.dropOffConfigDiv),s=e.div("MatcToobarRow MatcToolbarRadioList").build(t);this.dropOffTimeCheckBox=this.$new(D.Z,{maxLabelLength:20}),this.dropOffTimeCheckBox.setOptions([{value:!1,label:"Drop Off"},{value:!0,label:"Time"}]),this.dropOffTimeCheckBox.setValue(!1),this.dropOffTimeCheckBox.placeAt(s),this.own((0,g.Z)(this.dropOffTimeCheckBox,"change",u.Z.hitch(this,"selectDropOffTask"))),this.dropOffOptionsDiv=this.createSection("Tasks"),t=this.createContent(this.dropOffOptionsDiv),s=e.div("MatcToobarRow ").build(t),this.dropOffTaskBtn=this.$new(D.Z,{maxLabelLength:20});var i=[];this.testSettings.tasks&&this.testSettings.tasks.length>=1?i=this.testSettings.tasks.map((function(e,t){return{value:t,label:e.name}})):this.dropOffOptionsLabel=e.span("MatcToolbarLabel MatcToolbarHelpSection",this.getNLS("analytics.canvas.dropoff.hintNoTasksDefined")).build(s),this.dropOffTaskBtn.setOptions(i),this.dropOffTaskBtn.setValue(0),l.Z.add(this.dropOffTaskBtn.domNode,"MatcToolbarRadioList"),this.dropOffTaskBtn.placeAt(s),this.own((0,g.Z)(this.dropOffTaskBtn,"change",u.Z.hitch(this,"selectDropOffTask"))),this.dropOffChartDivCntr=this.createSection("Insights"),t=this.createContent(this.dropOffChartDivCntr);var o=e.div("MatcCenter ").build(t);this.dropoffTaskSuccess=this.createRing("Success","analytics.canvas.kpi.first-clicks"),l.Z.add(this.dropoffTaskSuccess.domNode,"MatcMarginBottom"),this.dropoffTaskSuccess.placeAt(o);var n=e.div("MatcMarginBottom").build(o),a=this.createBigNumber(e,n,"Duration","analytics.canvas.kpi.before-click");this.dropOffTaskDuration=a[0],this.dropOffTaskDurationLabel=a[1],n=e.div("MatcMarginBottom").build(o),a=this.createBigNumber(e,n,"Interactions","analytics.canvas.kpi.before-click"),this.dropOffInteractions=a[0],this.dropOffInteractionsLabel=a[1],this.dropOffFunnelDivCntr=this.createSection("Drop Off"),t=this.createContent(this.dropOffFunnelDivCntr),this.dropOffChartDiv=e.div("MatcToolbarDropOffChart","").build(t)},renderSessionProperties:function(){var e=this;this.logger.log(2,"renderSessionProperties","entry");var t=new S.Z;this.sessionOptionsDiv=this.createSection("Show");var s=this.createContent(this.sessionOptionsDiv),i=t.div("MatcToobarRow ").build(s);this.sessionTreeCheckBox=this.$new(T.Z),l.Z.add(this.sessionTreeCheckBox.domNode,"MatcToolbarItem"),this.sessionTreeCheckBox.setValue(!0),this.sessionTreeCheckBox.setLabel("Merge Graph"),this.sessionTreeCheckBox.placeAt(i),this.own((0,g.Z)(this.sessionTreeCheckBox,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionOutlierCheckbox=this.$new(T.Z),l.Z.add(this.sessionOutlierCheckbox.domNode,"MatcToolbarItem"),this.sessionOutlierCheckbox.setValue(!1),this.sessionOutlierCheckbox.setLabel("Show Outlier"),this.sessionOutlierCheckbox.placeAt(i),this.own((0,g.Z)(this.sessionOutlierCheckbox,"change",u.Z.hitch(this,"showUserJourneyOutlier"))),this.sessionOutlierDiv=this.createSection("Colors"),s=this.createContent(this.sessionOutlierDiv),i=t.div("MatcToobarRow ").build(s),this.sessionLineColor=this.$new(L.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionLineColor.placeAt(i),this.sessionLineColor.setLabel("Graph"),this.sessionLineColor.setModel(this.model),this.sessionLineColor.setValue("#33b5e5"),l.Z.add(this.sessionLineColor.domNode," hidden"),this.own((0,g.Z)(this.sessionLineColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionTaskLineColor=this.$new(L.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionTaskLineColor.placeAt(i),this.sessionTaskLineColor.setLabel("Task"),this.sessionTaskLineColor.setModel(this.model),this.sessionTaskLineColor.setValue("#92c500"),l.Z.add(this.sessionTaskLineColor.domNode,""),this.own((0,g.Z)(this.sessionTaskLineColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionOutlierColor=this.$new(L.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.sessionOutlierColor.placeAt(i),this.sessionOutlierColor.setLabel("Outlier"),this.sessionOutlierColor.setModel(this.model),this.sessionOutlierColor.setValue("#ffb61c"),l.Z.add(this.sessionOutlierColor.domNode,""),this.own((0,g.Z)(this.sessionOutlierColor,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionShowDiv=this.createSection("Options"),s=this.createContent(this.sessionShowDiv),i=t.div("MatcToobarRow MatcToolbarRadioList").build(s),this.sessionTimeCheckBox=this.$new(D.Z,{maxLabelLength:20}),this.sessionTimeCheckBox.setOptions([{value:!1,label:"Navigation"},{value:!0,label:"Time"}]),this.sessionTimeCheckBox.setValue(!1),this.sessionTimeCheckBox.placeAt(i),this.own((0,g.Z)(this.sessionTimeCheckBox,"change",u.Z.hitch(this,"showUserJourney"))),this.sessionTaskCntr=this.createSection("Tasks"),s=this.createContent(this.sessionTaskCntr),i=t.div("MatcToobarRow ").build(s);var o=[{value:-1,label:"No Task"}];if(this.testSettings.tasks)for(var n=0;n<this.testSettings.tasks.length;n++){var a=this.testSettings.tasks[n];o.push({value:n,label:a.name})}this.sessionTaskBtn=this.$new(D.Z,{maxLabelLength:20}),this.sessionTaskBtn.setOptions(o),this.sessionTaskBtn.setValue(-1),l.Z.add(this.sessionTaskBtn.domNode,"MatcToolbarRadioList"),this.sessionTaskBtn.placeAt(i),this.own((0,g.Z)(this.sessionTaskBtn,"change",u.Z.hitch(this,"selectUserJournyTask"))),this.sessionDiv=this.createSection("Tests"),s=this.createContent(this.sessionDiv),l.Z.add(s,"MatcMarginBottomXXL"),i=t.div("MatcToobarRow").build(s),this.sessionOrderBrn=this.$new(x.Z,{maxLabelLength:20}),this.sessionOrderBrn.setOptions([{value:"duration",label:"Sort by Duration"},{value:"events",label:"Sort by Events"},{value:"date",label:"Sort by Date"},{value:"weirdness",label:"Sort by Outlier"}]),this.sessionOrderBrn.setPopupCss("MatcActionAnimProperties"),this.sessionOrderBrn.updateLabel=!0,this.sessionOrderBrn.reposition=!0,this.sessionOrderBrn.setValue("duration"),this.sessionOrderBrn.placeAt(i),this.tempOwn((0,g.Z)(this.sessionOrderBrn,"change",(function(t){e.onSortSessionList(t)}))),this.addTooltip(this.sessionOrderBrn.domNode,"Change the sort order of the session list"),this.sessionListCntr=t.div("MatcToobarRow").build(s),this.sessionList=this._getTestList(this.events,this.annotation,this.testSettings),this.renderSessionList(this.sessionListCntr,this.sessionList,"duration")},onSortSessionList:function(e){this.renderSessionList(this.sessionListCntr,this.sessionList,e),this.selectUserJournyTask(this.sessionTaskBtn.getValue())},renderSessionList:function(e,t,s){var i=new S.Z;e.innerHTML="",this.sessionCheckBoxes={},this.sessionAllCheckBox=this.$new(T.Z),this.sessionAllCheckBox.setLabel("Show All"),this.sessionAllCheckBox.setValue(!0),l.Z.add(this.sessionAllCheckBox.domNode,"MatcToolbarItem"),this.sessionAllCheckBox.placeAt(i.div("MatcToobarRow").build(e)),this.own((0,g.Z)(this.sessionAllCheckBox,"change",u.Z.hitch(this,"selectAllSessions"))),t.sort((function(e,t){return"duration"===s?t.duration-e.duration:"date"===s?e.start-t.start:"weirdness"===s?t.weirdness-e.weirdness:t.size-e.size}));for(var o=0;o<t.length;o++){var n=t[o],a=i.div("MatcToobarRow MatcToobarRowIconCntr").build(e),r=this.$new(T.Z);l.Z.add(r.domNode,"MatcToolbarItem"),r.setValue(!0),"duration"===s&&r.setLabel("Test "+n.id+" ("+n.duration+"s )"),"date"===s&&r.setLabel("Test "+n.id+" ("+n.date+")"),"events"===s&&r.setLabel("Test "+n.id+" ("+n.size+")"),"weirdness"===s&&r.setLabel("Test "+n.id+" ("+n.weirdness+")"),r.placeAt(i.div().build(a)),this.sessionCheckBoxes[n.session]=r,this.own((0,g.Z)(r,"change",u.Z.hitch(this,"selectSession"))),this.own((0,g.Z)(a,"mouseover",u.Z.hitch(this,"hoverSession",n))),this.own((0,g.Z)(a,"mouseout",u.Z.hitch(this,"hoverSession",null)));var h=i.div("MatcToobarRowRightIcon").span("mdi mdi-play").build(a);this.own((0,g.Z)(h,"click",u.Z.hitch(this,"showSession",n)))}},hoverSession:function(e){this.canvas&&this.canvas.highlightSession(null===e||void 0===e?void 0:e.session)},showUserJourneyOutlier:function(e){if(e){var t=this.canvas.getOutlierScores();for(var s in this.sessionCheckBoxes){var i=this.sessionCheckBoxes[s];t[s]?l.Z.remove(i.domNode,"MatcToolbarItemStrikeThrough"):l.Z.add(i.domNode,"MatcToolbarItemStrikeThrough")}}else for(var o in this.sessionCheckBoxes){var n=this.sessionCheckBoxes[o];l.Z.remove(n.domNode,"MatcToolbarItemPassive"),l.Z.remove(n.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},selectUserJournyTask:function(e){if(e>=0){var t=this.testSettings.tasks[e],s=this.canvas.getTaskPerformance();for(var i in this.sessionCheckBoxes){var o=this.sessionCheckBoxes[i];s[i]&&s[i][t.id]?l.Z.remove(o.domNode,"MatcToolbarItemStrikeThrough"):l.Z.add(o.domNode,"MatcToolbarItemStrikeThrough")}}else for(var n in this.sessionCheckBoxes){var a=this.sessionCheckBoxes[n];l.Z.remove(a.domNode,"MatcToolbarItemPassive"),l.Z.remove(a.domNode,"MatcToolbarItemStrikeThrough")}this.showUserJourney()},selectAllSessions:function(e){for(var t in this.sessionCheckBoxes)this.sessionCheckBoxes[t].setValue(e);this.showUserJourney()},setSelectSessions:function(e){if(this.sessionCheckBoxes){for(var t in this.sessionCheckBoxes)e.indexOf(t)>=0?this.sessionCheckBoxes[t].setValue(!0):this.sessionCheckBoxes[t].setValue(!1);this.sessionAllCheckBox.setValue(!1),this.showUserJourney()}},selectSession:function(){this.showUserJourney()},_getTestList:function(e,t,s){var i=[];s.tasks||(s.tasks=[],console.warn("_getTestList() > Added missing task array"));var o=new W.Z(e);o.sortBy("time");var n=o.groupBy("session"),a=n.data,r=new W.Z(t).groupBy("reference"),l=new N.Z,h=s.tasks.length,c=l.getMergedTaskPerformance(o,s.tasks,t),d=c.count("session"),u=this.canvas.getOutlierScores(),g=1;for(var v in a){var m=a[v],p=this.formatDate(m.min("time"),!0),f=r.get(v),M='<span class="MatchDashStatusSuccess">Valid</span>',C=!0;f&&(C=f.get(0).get("isValid"),C||(M='<span class="MatchDashStatusFailure">Failure</span>'));var w=d.get(v);w||(w=0);var y=new W.Z(m.data),S=y.select("type","in",["ScreenClick","WidgetClick","WidgetChange","ScreenGesture","WidgetGesture"]),b={session:v,taskPerformance:w+" / "+h,weirdness:u[v],duration:Math.ceil((m.max("time")-m.min("time"))/1e3),date:p,start:m.min("time"),size:S.size(),status:M,isValid:C,id:g,screens:m.unique("screen")};i.push(b),g++}return i.sort((function(e,t){return e.id-t.id})),i},renderGestureProperties:function(){var e=new S.Z;this.gestureOptionsDiv=this.createSection("Options");var t=this.createContent(this.gestureOptionsDiv),s=e.div("MatcToobarRow MatcMarginBottomXXL").build(t);e.span("MatcToolbarItemLabel","Gesture Color").build(s),this.gestureLineColor=this.$new(L.Z,{updateColor:!0,hasCustomColor:!1,hasPicker:!1}),this.gestureLineColor.placeAt(s),this.gestureLineColor.setLabel("Line Color"),this.gestureLineColor.setModel(this.model),this.gestureLineColor.setValue("#0099cc"),this.own((0,g.Z)(this.gestureLineColor,"change",u.Z.hitch(this,"showGestureMap")))},showDwellDistribution:function(e){if(this.logger.log(0,"showDwellDistribution","entry > "),this._selectedScreen){var t=new W.Z(this.events),s=new N.Z,i=s.getScreenTimeGrouping(t),o=i.get(this._selectedScreen.id);if(o){var n=new S.Z,a=new k.Z,r=n.div("MatcPadding DashTaskListDetailsDialog").build();n.h2("MatcDialogTitle","Dwell Time Distribution &quot"+this._selectedScreen.name+"&quot").build(r);var l=n.div("DashTaskListDialogHist").build(r),h=o.hist(null,10),c=this.$new(R);c.setFormTo((function(e){return Math.round(e/1e3)+" sec"})),c.onHover((function(e){return Math.round(e.from/1e3)+" - "+Math.round(e.to/1e3)+" sec ("+e.count+" x)"})),c.setValue(h,o.mean()),c.placeAt(l),a.popup(r,e.target)}}},showGestureProperties:function(){this.logger.log(1,"showGestureProperties","entry > "),this.showProperties(),l.Z.remove(this.gestureOptionsDiv,"MatcToolbarSectionHidden")},showWidgetProperties:function(e){this.logger.log(1,"showWidgetProperties","entry > "+e.id+" "+e.name),this.showProperties(),l.Z.remove(this.widgetNameDiv,"MatcToolbarSectionHidden"),this.widgetName.value=e.name;var t=this.canvas.getWidgetData(e);if(t[e.id]){var s=t[e.id];this.widgetClickRing.setPs(s.clicksRel),this.widgetClickRing.setValue(s.clicksAbs),isNaN(s.firstClicksRelScreen)&&(s.firstClicksRelScreen=0),this.widgetFirstClickRing.setPs(s.firstClicksRelScreen),this.widgetFirstClickRing.setValue(s.firstClicksAbs),this.setTextContent(this.widgetDiscoverSTDLabel,"+/-"+Math.round(s.discoverTimeStd/1e3)+"s"),this.setTextContent(this.widgetDiscoverLabel,Math.round(s.discoverTimeAbs/1e3)+"s")}},showScreenProperties:function(e){var t,s,i,o,n;this.logger.log(0,"showScreenProperties","entry"),this.showProperties(),l.Z.remove(this.screenShapeDiv,"MatcToolbarSectionHidden"),this.screenName.value=e.name,e.style.overlay?(t=this.canvas.getOverlayDwellTime(),s=this.canvas.getOverlayViews(),i=this.canvas.getOverlayClicks(),o=this.canvas.getOverlayWidgetClicks(),n=this.canvas.getOverlayTest()):(t=this.canvas.getScreenDwellTime(),s=this.canvas.getScreenViews(),i=this.canvas.getScreenClicks(),o=this.canvas.getScreenWidgetClicks(),n=this.canvas.getScreenTests());var a=t.times[e.id];a||(a=0);var r=i.clicks[e.id],h=o.clicks[e.id],c=r+h,d=a/t.sessions,u=s.counts[e.id];u||(u=0);var g=n.counts[e.id];g||(g=0),this.screenTotalViewRing.setValue(u),this.screenTotalViewRing.setPs(u/s.total),this.screenTestRing.setValue(g),this.screenTestRing.setPs(g/n.sessions),this.screenClickRing.setPs(r/c),this.screenClickRing.setValue(r),this.screenWidgetClickRing.setPs(h/c),this.screenWidgetClickRing.setValue(h),this.screenDwellRing.setPs(a/t.total),this.screenDwellRing.setValue(Math.round(d/1e3)+"s")},showSessionProperties:function(){this.logger.log(0,"showSessionProperties","entry"),this.showProperties(),l.Z.remove(this.sessionDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionOptionsDiv,"MatcToolbarSectionHidden"),this.sessionTreeCheckBox.getValue()?(l.Z.add(this.sessionTaskCntr,"MatcToolbarSectionHidden"),l.Z.add(this.sessionLineColor.domNode,"hidden"),l.Z.add(this.sessionTaskBtn.domNode,"hidden"),l.Z.remove(this.sessionShowDiv,"MatcToolbarSectionHidden"),l.Z.add(this.sessionLineColor.domNode,"hidden"),l.Z.add(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),l.Z.add(this.sessionOutlierCheckbox.domNode,"hidden")):(l.Z.remove(this.sessionTaskCntr,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionLineColor.domNode,"hidden"),l.Z.remove(this.sessionTaskBtn.domNode,"hidden"),l.Z.add(this.sessionShowDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionLineColor.domNode,"hidden"),l.Z.remove(this.sessionOutlierDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.sessionOutlierCheckbox.domNode,"hidden"))},selectDropOffTask:function(){this.showDropOffProperties()},showDropOffProperties:function(){this.logger.log(0,"showDropOffProperties","entry");var e=this.dropOffTaskBtn.getValue(),t=this.testSettings.tasks[e];t?(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:t,color:"#ccc"}),l.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffChartDivCntr,"MatcToolbarSectionHidden"),this.showDropOffChart(t),this.showProperties()):(this.setAnalyticMode("DropOff",{time:this.dropOffTimeCheckBox.getValue(),task:null,color:"#ccc"}),l.Z.remove(this.dropOffConfigDiv,"MatcToolbarSectionHidden"),l.Z.remove(this.dropOffOptionsDiv,"MatcToolbarSectionHidden"),this.showProperties())},showDropOffChart:function(e){var t=new W.Z(this.events),s=new N.Z,i=s.getFunnelSummary(t,e,this.annotation),o=i[i.length-1];this.dropoffTaskSuccess.setPs(o.p),this.dropoffTaskSuccess.setValue(Math.round(100*o.p)+"%"),this.dropOffTaskDuration.innerText=Math.round(o.durationMean/100)/10+"s",this.dropOffTaskDurationLabel.innerText="+/-"+Math.round(o.durationStd/100)/10+"s",this.dropOffInteractions.innerText=Math.round(o.interactionsMean),this.dropOffInteractionsLabel.innerText="+/-"+Math.round(o.interactionsStd)},showDropOffFunnel:function(e){var t=this;this.dropOffChartDiv.innerHTML="";var s=new S.Z,i=s.div().build();e.forEach((function(e,o){if(e.event){s.span("MatcDashLabel",t.getNiceEventLabel(e.event,o)).build(i);var n=s.div("MatcToolbarDropOffChartBar",Math.round(100*e.p)+"%").build(i);n.style.background=t.greenToRed(e.p),n.style.width=100*e.p+"%"}})),this.dropOffChartDiv.appendChild(i)},getNiceEventLabel:function(e,t){if(this.model){var s=[];if(e.widget){if("WidgetGesture"!=e.type||!e.gesture)return!e.state||"WidgetClick"!=e.type&&"WidgetChange"!=e.type?this.getEventLabel(e.type)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen):this.getEventStateLabel(e.state)+" -  "+this.getWidgetName(e.widget)+" @ "+this.getScreenName(e.screen);var i=e.gesture;s=[this.getGestureLabel(i.type),this.getWidgetName(e.widget)]}else if("ScreenGesture"==e.type&&e.gesture){var o=e.gesture;s=["Screen "+this.getGestureLabel(o.type),this.getScreenName(e.screen)]}else s=[this.getEventLabel(e.type),this.getScreenName(e.screen)];return s[0]+" - "+s[1]}return this.getNLS("dash.perf.dropoff.step")+t},showHeatMapProperties:function(){this.showProperties(),l.Z.remove(this.heatmapDiv,"MatcToolbarSectionHidden"),this.heatmapClickList.setValue(this.analyticHeatMapClicks)},showProperties:function(){l.Z.remove(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&l.Z.add(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen")},hideProperties:function(){"UserJourney"==this.analyticMode?(this.hideAllSections(),this.showSessionProperties()):"HeatmapClick"==this.analyticMode?(this.hideAllSections(),this.showHeatMapProperties()):(l.Z.add(this.propertiesCntr,"MatcToolbarSectionHidden"),this.canvas&&l.Z.remove(this.canvas.scrollRight,"MatcCanvasScrollBarRightOpen"),this.hideAllSections())},hideAllSections:function(){this.logger.log(3,"hideAllSections","entry");for(var e=0;e<this.sections.length;e++){var t=this.sections[e];l.Z.add(t,"MatcToolbarSectionHidden")}},setController:function(e){this.logger.log(3,"setController","entry"),this.controller=e},setCanvas:function(e){this.logger.log(3,"setCanvas","entry"),this.canvas=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e},setModel:function(e){this.model=this.createInheritedModel(e),this.renderToolbar(),this.render()},setAnnotation:function(e){this.logger.log(-1,"setAnnotation","enter > # "),this.annotation=e},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setEvents:function(e){this.logger.log(2,"setEvents","enter > # "+e.length),this.events=e},setMode:function(e){this.logger.log(2,"setMode","entry > '"+e+"'"),this.mode=e,this.onModeChange()},onModeChange:function(){},setSelectedViewButton:function(e){for(var t=0;t<this.viewBtns.length;t++)l.Z.remove(this.viewBtns[t],"MatcToolbarItemActive");l.Z.add(e,"MatcToolbarItemActive")},createRing:function(e,t,s){var i="#cecece",o=this.canvas.getSettings();"MatcDark"==o.canvasTheme&&(i="#777");var n=this.$new(B.Z,{size:100,width:5,backgroundColor:i,color:"#0099cc",color2:"#83b600",color3:"#ffa713"});return n.setDomSize(120,120),n.setLabel(e),s&&(n.setAction("mdi mdi-chart-bar"),this.tempOwn(n.on("action",u.Z.hitch(this,s)))),t&&(n.setHelp(!0),this.tempOwn(n.on("help",u.Z.hitch(this,"showHelpDialog",t)))),l.Z.add(n.domNode,"MatcMarginTop"),n},createToolBarItem:function(e,t,s,i){var o=document.createElement("div");if(l.Z.add(o,"MatcToolbarItem MatcToolbarPrimaryItem"),s){var n=document.createElement("span");l.Z.add(n,s),o.appendChild(n)}var a=document.createElement("label");return l.Z.add(a,"MatcToolbarLabel"),a.innerHTML=e,o.appendChild(a),t&&this.tempOwn((0,g.Z)(o,f.Z.press,u.Z.hitch(this,t))),i?i.appendChild(o):this.properties.appendChild(o),o},createInput:function(e,t){var s=document.createElement("div");l.Z.add(s,"MatcToolbarItem"),e.appendChild(s);var i=document.createElement("input");return i.disabled=!0,l.Z.add(i,"MatcIgnoreOnKeyPress MatcToobarInput  MatcToobarInlineEditDisabled"),s.appendChild(i),t&&(i.placeholder=t),i},createContent:function(e){var t=document.createElement("div");return l.Z.add(t,"MatcToolbarSectionContent"),e.appendChild(t),t},createSection:function(e,t){var s=document.createElement("div");l.Z.add(s,"MatcToolbarSection");var i=this.createSectionHeader(s,e,t);return this.own((0,g.Z)(i,f.Z.press,(function(){return l.Z.toggle(s,"MatcToolbarSectionCollabsed"),!1}))),this.sections.push(s),this.properties.appendChild(s),s},createSectionHeader:function(e,t,s){var i=document.createElement("div");if(l.Z.add(i,"MatcToolbarSectionLabel"),e.appendChild(i),i.innerHTML=t,s){var o=document.createElement("span");l.Z.add(o,"MatcToolbarSectionMarker"),o.innerHTML=" *",i.appendChild(o)}var n=document.createElement("span");return l.Z.add(n,"MatcToolbarSectionChevron mdi mdi-chevron-down"),i.appendChild(n),i},createBigNumber:function(e,t,s,i){var o=e.div("MatcToolBarNumberCntr MatcMarginTop").build(t),n=e.div("MatcDashLabel",s).build(o),a=e.div("MatcToolbarBigLabel").build(o),r=e.div("MatcToolbarDetailLabel").build(o);if(i){var l=e.span("mdi mdi-help-circle MatcHelpIcon").build(n);this.tempOwn((0,g.Z)(l,f.Z.press,u.Z.hitch(this,"showHelpDialog",i)))}return[a,r]},onExit:function(){this.logger.log(0,"onExit","entry",this.isPublic),this.isPublic?(0,M.Z)("#/examples/"+this.model.id+"/design.html"):(0,M.Z)("#/apps/"+this.model.id+"/design.html")},onShare:function(){this.logger.log(0,"onShare","entry")},onWidgetSelected:function(e){this.logger.log(2,"onWidgetSelected","entry"),this._selectedWidget&&this._selectedWidget.id!=e.id&&(this.logger.log(3,"onWidgetSelected","exit > no new selection!"),this.blurWidgetProperties()),this.cleanUp(),this._selection="widget",this._selectedWidget=e,this.showWidgetProperties(e),this.logger.log(3,"onWidgetSelected","exit")},onScreenSelected:function(e){this.logger.log(-1,"onScreenSelected","entry",this._selectedScreen),this._selectedScreen&&this._selectedScreen.id==e.id?this.logger.log(3,"onScreenSelected","exit > no new selection!"):(this.cleanUp(),this._selection="screen",this._selectedScreen=e,this.showScreenProperties(e),this.logger.log(4,"onScreenSelected","exit"))},onLineSelected:function(e){this.cleanUp(),this._selection="line",this._selectedLine=e},onMultiSelect:function(e){this.cleanUp(),this._selection="multi",this._selectedMulti=e},onGroupSelect:function(e){this.cleanUp(),this._selection="group",this._selectedGroup=e,this.showGroupProperties(e)},onCanvasSelected:function(){this.cleanUp(),this.hideProperties()},updatePropertiesView:function(){this._selectedWidget&&this.onWidgetSelected(this._selectedWidget)},showSession:function(e,t){var s=this,i=e.session,o=new k.Z,n=new S.Z,a=n.div("MatcDialog MatcPlayerDialog ").build(),r=n.div("").build(a);o.onOpen((function(){s.isPublic?Promise.all([s.modelService.findPublicTagAnnotations(s.model.id),s.modelService.findPublicMouseBySession(s.model.id,i)]).then((function(e){s._showSession(i,r,o,e)})):Promise.all([s.modelService.findTagAnnotations(s.model.id),s.modelService.findMouseBySession(s.model.id,i)]).then((function(e){s._showSession(i,r,o,e)}))})),o.popup(a,t.target)},_showSession:function(e,t,s,i){try{var o=i[1],n=new W.Z(this.events);n.sortBy("time");var a=n.groupBy("session"),r=a.get(e),l=this.$new(F.Z);l.setDialog(s),l.placeAt(t),l.setModel(this.model),l.setTestSettings(this.testSettings),l.setMouse(o),l.setMouse(o),l.setSession(r,e),s.own((0,g.Z)(s,"close",(function(){l.destroy()})))}catch(h){console.error(h)}},_getSessionAnnotation:function(e,t){if(e.length>1){console.warn("Too many annotations!");for(var s=1;s<e.length;s++){var i=e[s];this._doDelete("rest/annotations/apps/"+t+"/"+i.id+".json")}}return e.length>=1?e[0]:{appID:t,type:"tags",reference:"",sessions:{}}},onShowSettings:function(e){var t=new S.Z;t=new S.Z;var s=t.div("MatcDialog MatcHeaderDialog MatcPadding").build(),i=t.div("").build(s),o=this.canvas.getSettings();t.label("","Theme :").build(i);var n=this.$new(D.Z);n.setOptions([{value:"MatcDark",label:"Dark"},{value:"MatcLight",label:"Light"}]),n.setValue(o.canvasTheme),n.placeAt(i),t.label("MatcMarginTop","Mouse Wheel / Touchpad Scroll :").build(i);var a=this.$new(D.Z);a.setOptions([{value:"scroll",label:"Scroll Canvas"},{value:"zoom",label:"Zoom Canvas"}]),a.setValue(o.mouseWheelMode),a.placeAt(i);var r=t.div("MatcButtonBar MatcMarginTopXL").build(s),l=t.a("MatcButton MatcButtonPrimary","Save").build(r),h=t.a(" MatcLinkButton ","Cancel").build(r),c=new k.Z;c.own((0,g.Z)(h,f.Z.press,u.Z.hitch(c,"close"))),c.own((0,g.Z)(l,f.Z.press,u.Z.hitch(this,"onSaveSettings",c,n,a))),c.popup(s,e.target),this.canvas.enableMouseZoom(!1),this.canvas.setState("simulate"),this.logger.log(0,"onShowSettings","exit > ")},onSaveSettings:function(e,t,s){var i={canvasTheme:t.getValue(),mouseWheelMode:s.getValue()};this.canvas.setSettings(i),this.canvas.enableMouseZoom(!0),e.close()},showSignUpDialog:function(e){var t=new k.Z,s=new S.Z,i=s.div("MatcDialog ").build();this._createSignUpForm(t,i),t.popup(i,e.target)},_createSignUpForm:function(e,t){var s=this.$new(_.Z);return s.render([{label:"Email",name:"email",type:"text",required:"true",placeholder:"Your email",css:"input-lg MatcIgnoreOnKeyPress",error:"We need your email."},{label:"Password",name:"password",type:"password",min:6,placeholder:"Your password",css:"input-lg MatcIgnoreOnKeyPress",error:"The password should have at least six characters."},{label:'I have read the <a href="#/termsofservice.html" target="_blank">terms of service</a>',name:"tos",type:"check",required:"true",css:"MatcFormCheckBox MatcIgnoreOnKeyPress",error:"You must accept the terms of service!"}],[{label:"Cancel",css:"MatcLinkButton",click:u.Z.hitch(e,"close")},{label:"Create Free Account",css:"MatcButton MatchButtonGreen",click:u.Z.hitch(this,"_signUpAndNew",e,s)}]),s.placeAt(t),s.startup(),s},_signUpAndNew:function(e,t,s){var i=t.validateForm(null,!0);if(i)if(o=this._doPost("rest/user",s),"error"==o.type)o.errors.indexOf("user.email.not.unique")>=0?t.showError("The email is already taken! Please enter another one!","email"):t.showError("Something went wrong! Please try again!",""),e.shake();else{e.close();var o=this._doPost("rest/login/",s);"error"!=o.type?window.location.href="/my-account.html":console.error("_signUpAndSave() > Could not sign in user")}else e.shake()},cleanUp:function(){this.hideAllSections(),this.unselect()},unselect:function(){this._selectedWidget=null,this._selectedLine=null,this._selectedScreen=null,this._selectedMulti=null,this._selectedGroup=null,this._selection=null},blurWidgetProperties:function(){}},mounted:function(){}},oe=ie,ne=(0,E.Z)(oe,m,p,!1,null,null,null),ae=ne.exports,re=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},le=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[s("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[s("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable",attrs:{"data-dojo-attach-point":"container"}},[s("div",{staticClass:"MatcCanvasContainer",attrs:{"data-dojo-attach-point":"zoomContainer"}},[s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}}),s("div",{staticClass:"MatcCanvasLayer MatcCanvasSVGLayer",attrs:{"data-dojo-attach-point":"svgContainer"}})]),s("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"}})])]),s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])]),s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",attrs:{"data-dojo-attach-point":"scrollBottom"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])]),s("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])}],he=(s(57327),s(16328)),ce=s(19721),de=s(85877),ue=s(89224),ge=s(25282),ve=s(17513),me=s(22578),pe=s(22579),fe=s(71842),Me=s(4803),Ce=s(73614),we=s(20293),ye=s(7611),Se=s(81102),be=s(9982),ke=s(49685),Ze=s(70143),Te=s(96765),De=s(5403),_e=s(97878),xe=s(69912),Le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},Be=[],Oe=s(75200),Pe=(s(26833),s(4723),{name:"UserJourney",mixins:[],data:function(){return{}},components:{},methods:{highlightSession:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.analyticParams.tree||this.highlightAnalyticLine(e)},highlightAnalyticLine:function(e){var t=this;if(this.logger.log(1,"highlightAnalyticLine","entry > ",e),this.analyticLines){var s=function(s){var i=t.analyticLines[s];if(e&&e!==s?i.style("opacity",0):i.style("opacity",1),t.analyticCircles[s]){var o=t.analyticCircles[s];o.forEach((function(t){t.style.opacity=e&&e!==s?0:1}))}};for(var i in this.analyticLines)s(i)}},_render_global_UserJourney:function(e,t,s,i){this.logger.log(1,"_render_global_UserJourney","entry > "),this.setBW(!0),this.cleanUpAnalytics(),this.analyticParams.tree?this._renderUserTree(e,t,s,i):this._renderUserSingleLines(e,t,s,i)},_renderUserTree:function(){var e=this.getUserJourney(),t=new S.Z,s=this.analyticParams.time,i=this.analyticParams.sessions,o={},n=0,a=0;for(var r in i)if(!0===i[r]){var l=e[r];l?(this._getSessionGraph(l,o,s),n++):console.debug("_renderUserTree() > No session for ",r)}for(var h in o){var c=o[h];c.count>n&&(console.warn("_renderUserTree() > Update maxcount, because l.count bigger than max count"),n=c.count);var d=c.duration/c.count;a=Math.max(d,a)}var u={};for(var g in o){var v=o[g],m=[];m.push({x:v.from.x,y:v.from.y,d:"right"}),m.push({x:v.to.x,y:v.to.y,d:"right"});var p=v.duration/v.count,f=s?Math.min(1,p/a):Math.min(1,v.count/n),M=Math.min(15,Math.max(1,Math.round(25*f)))+1,C=this.mixColor(Math.min(1,f)),w=v.to.x+","+v.to.y,y=v.from.x+","+v.from.y;u[w]||(u[w]=this._renderTreeEvent(v.to.x,v.to.y,M,C,t)),u[y]||(u[y]=this._renderTreeEvent(v.from.x,v.from.y,M,C,t)),this.drawAnalyticLine(g,m,C,M,this.taskLineOpacity)}},_renderTreeEvent:function(e,t,s,i,o){var n=o.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);n.style.left=Math.round(e)+"px",n.style.top=Math.round(t)+"px";var a=o.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(n),r=Math.round(2*s);a.style.width=r+"px",a.style.height=r+"px",a.style.top=-1*Math.round(r/2)+"px",a.style.left=-1*Math.round(r/2)+"px",a.style.background=i},_renderUserSingleLines:function(){var e=this.getUserJourney(),t=this.getOutlierScores(),s=this.getTaskPerformance(),i=new S.Z,o=null;!1!==this.analyticParams.task&&this.analyticParams.task>=0&&(o=this.testSettings.tasks[this.analyticParams.task]);var n=this.analyticParams.sessions;for(var a in n)if(!0===n[a]){var r=e[a],l=s[a],h=t[a];r?this._renderUserGraph(a,r,i,o,l,h):console.debug("_render_global_UserJourney() > No session for ",a)}this.analyticParams.outlier&&this.showHint("Found ".concat(Object.values(t).filter((function(e){return 1===e})).length," outliers"))},_renderUserGraph:function(e,t,s,i,o,n){var a,r,h=t.data,c=[],d=h.length,u=[],g=null,v=0,m=0;i&&o&&(r=o[i.id]);for(var p=0;p<d;p++){g=h[p],a&&(v=g.time-a.time,m=Math.max(v,m));var f=this.getEventScreenId(g),M=this.sourceModel.screens[f],C=this.model.screens[f];if(M&&C){if("SessionStart"==g.type){var w=M.x-Math.max(10,Math.round(30*this.zoom)),y=M.y+Math.max(10,Math.round(30*this.zoom));c.push({x:w,y:y,d:"right",duration:v,type:g.type,session:g.session})}else if(g.x>=0&&g.y>=0&&!g.noheat){var S=g.x*M.w+M.x,b=g.y*M.h+M.y;c.push({x:S,y:b,d:"right",duration:v,type:g.type,session:g.session}),a=g}if(r&&r.startPosition<=p&&r.endPosition>=p){var k=c[c.length-1];k.match=!0,u.push(k)}}else console.warn("_renderUserGraph()","Screen is not there",g.screen)}if(g&&"ScreenLoaded"===g.type){var Z=this.getEventScreenId(g),T=this.sourceModel.screens[Z],D=Math.round(T.x+T.w/2),_=Math.round(T.y+T.h/2);if(c.push({x:D,y:_,d:"right",duration:v,type:g.type,session:g.session}),r&&r.startPosition<=d-1&&r.endPosition>=d-1){var x=c[c.length-1];x.match=!0,u.push(x)}}this.analyticCircles[e]=[];for(var L=0;L<c.length;L++){var B=c[L],O=Math.round(B.duration/m*40)+25,P=this._renderScreenEvent(B.x,B.y,B.type,"",s,B.session,O),W=(0,Oe.Z)(P,3),A=W[0],H=W[1],E=W[2];L==c.length-1?(l.Z.add(E,"MatcAnalyticCanvasEventSessionEnd"),A.style.background=this.userJourneyEndColor,H.style.background=this.userJourneyEndColor+28,H.style.borderColor=this.userJourneyEndColor):L>0&&(B.match?(A.style.background=this.analyticParams.taskColor,H.style.background=this.analyticParams.taskColor+28,H.style.borderColor=this.analyticParams.taskColor):n&&this.analyticParams.outlier?(A.style.background=this.analyticParams.outlierColor,H.style.background=this.analyticParams.outlierColor+28,H.style.borderColor=this.analyticParams.outlierColor):(A.style.background=this.analyticParams.color,H.style.background=this.analyticParams.color+28,H.style.borderColor=this.analyticParams.color)),this.analyticCircles[e].push(E)}var V=this.analyticParams.color,R=this.taskLineOpacity,N=2;return this.analyticParams.outlier&&(n?(V=this.analyticParams.outlierColor,R=this.taskLineOpacity,N=4):R=.5*this.taskLineOpacity),i?(R=.5*this.taskLineOpacity,this.drawStraightAnalyticLine(e,c,V,N,R),this.drawStraightAnalyticLine(e,u,this.analyticParams.taskColor,4,this.taskLineOpacity)):this.drawStraightAnalyticLine(e,c,V,N,R),!1},_renderScreenEvent:function(e,t,s,i,o,n,a){var r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:15,l=o.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);l.style.left=Math.round(e)+"px",l.style.top=Math.round(t)+"px";var h=o.div("MatcAnalyticCanvasEventHalo").build(l);h.style.width=a+"px",h.style.height=a+"px",h.style.top=-1*Math.round(a/2)+"px",h.style.left=-1*Math.round(a/2)+"px";var c=o.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasClickableEvent MatcAnalyticCanvasEvent"+s).build(l);return c.style.width=r+"px",c.style.height=r+"px",c.style.top=-1*Math.round(r/2)+"px",c.style.left=-1*Math.round(r/2)+"px",this.tempOwn((0,g.Z)(c,"click",u.Z.hitch(this,"onScreenEventClick",n))),[c,h,l]},onScreenEventClick:function(e,t){this.stopEvent(t),this.toolbar&&this.toolbar.setSelectSessions([e])},_getSessionGraph:function(e,t){for(var s,i,o=e.data,n=null,a=0,r=0;r<o.length;r++){n=o[r],i&&(a=n.time-i.time);var l=this.getEventScreenId(n),h=this.sourceModel.screens[l];if(h){var c={};if("SessionStart"==n.type)c.x=h.x-Math.max(10,Math.round(30)),c.y=h.y+Math.max(10,Math.round(30)),s=this._addToGraph(s,c,t,0);else if(n.x>=0&&n.y>=0&&!n.noheat)if(n.widget&&this.sourceModel.widgets[n.widget]){var d=this.sourceModel.widgets[n.widget];c.x=Math.round(d.x+d.w/2),c.y=Math.round(d.y+d.h/2),s=this._addToGraph(s,c,t,a),i=n}else c.x=Math.round(Math.min(1,n.x)*h.w+h.x),c.y=Math.round(Math.min(1,n.y)*h.h+h.y),s=this._addToGraph(s,c,t,a),i=n}else console.warn("_getSessionGraph()","Screen is not there",n.screen)}if(n&&"ScreenLoaded"===n.type){var u=this.getEventScreenId(n),g=this.sourceModel.screens[u],v={x:Math.round(g.x+g.w/2),y:Math.round(g.y+g.h/2)};s=this._addToGraph(s,v,t,a)}},_addToGraph:function(e,t,s,i){if(e){var o=e.x+";"+e.y+"-"+t.x+";"+t.y;return s[o]||(s[o]={from:e,to:t,count:0,duration:0}),s[o].count++,s[o].duration+=1*i,t}return t}},mounted:function(){}}),We=Pe,Ae=(0,E.Z)(We,Le,Be,!1,null,null,null),He=Ae.exports,Ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},Ve=[],Re={name:"DropOff",mixins:[],data:function(){return{}},components:{},methods:{_render_global_DropOff:function(e,t,s,i){this.logger.log(1,"_render_global_DropOff","entry > ",this.analyticParams.task),this.setBW(!0),this.analyticParams.task?this.analyticParams.time?this._render_dropoff_task_time(e,t,s,i,this.analyticParams.task):this._render_dropoff_task_success(e,t,s,i,this.analyticParams.task):this.showError("No task selected")},_render_dropoff_task_time:function(e,t,s,i,o){var n=new S.Z,a=new W.Z(this.events),r=new N.Z,l=r.getFunnelSummary(a,o,this.annotation),h=o.flow.length;if(o.flow&&o.flow.length>1)for(var c=Math.max(1,l[l.length-1].durationMean),d=0;d<o.flow.length-1;d++){var u=l[d+1],g=l[d+2],v=o.flow[d],m=o.flow[d+1],p=g.durationMean-u.durationMean,f=Math.min(1,p/c),M=this._getDropOffBoxPosition(v,d,h),C=this._getDropOffBoxPosition(m,d+1,h),w=[M,C],y=this.mixColor(f),b=Math.max(3,Math.round(this.dropOffLineWidth*f));this.drawAnalyticLine("dropOffLine"+d,w,y,b,this.taskLineOpacity),this._renderDropOffEvent(C.x,C.y,"FlowStep",n,y,b+this.dropOffEventWidth,Math.round(p/100)/10,"s"),0===d&&(y=this.mixColor(f),b=Math.max(3,Math.round(this.dropOffLineWidth*f)),this._renderDropOffEvent(M.x,M.y,"FlowStep",n,y,b+this.dropOffEventWidth,"0","s"))}else this.showError("Cannot show task times. The selected task has only one step.")},_render_dropoff_task_success:function(e,t,s,i,o){var n=new S.Z,a=new W.Z(this.events),r=new N.Z,l=r.getFunnelSummary(a,o,this.annotation),h=o.flow.length;if(o.flow&&o.flow.length>1)for(var c=0;c<o.flow.length-1;c++){var d=l[c+1],u=l[c+2],g=o.flow[c],v=o.flow[c+1],m=this._getDropOffBoxPosition(g,c,h),p=this._getDropOffBoxPosition(v,c+1,h),f=[m,p],M=this.greenToRed(u.p),C=Math.max(3,Math.round(this.dropOffLineWidth*u.p));if(this.drawAnalyticLine("dropOffLine"+c,f,M,C,this.taskLineOpacity),d&&u){var w=d.p-u.p,y={x:m.x+100,y:m.y+100},b=[m,y];C=Math.max(3,Math.round(this.dropOffLineWidth*w)),this.drawAnalyticLine("dropOffLineDrop"+c,b,this.dropOffLineColor,C,this.taskLineOpacity),this._renderDropOffEvent(y.x,y.y,"FlowStep",n,this.dropOffLineColor,C+this.dropOffEventWidth,Math.round(-100*w))}this._renderDropOffEvent(p.x,p.y,"FlowStep",n,M,C+this.dropOffEventWidth,Math.round(100*u.p)),0===c&&(M=this.greenToRed(d.p),C=Math.max(3,Math.round(this.dropOffLineWidth*d.p)),this._renderDropOffEvent(m.x,m.y,"FlowStep",n,M,C+this.dropOffEventWidth,Math.round(100*d.p)))}else this.showError("Cannot show task times. The selected task has only one step.")},_getDropOffBoxPosition:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(e.widget){var i=this.sourceModel.widgets[e.widget];if(i){var o={};return o.x=Math.round(i.x+i.w/2),o.y=Math.round(i.y+i.h/2),o}this.logger.warn("_geDropOffBoxPosition","no widget > ",e.widget)}if(e.screen){var n=this.sourceModel.screens[e.screen];if(n){var a={};return a.x=Math.round(n.x+n.w/2),a.y=Math.min(n.y+n.h,Math.round(n.y+n.h/3)+n.h*t/(2*s)),a}this.logger.warn("_geDropOffBoxPosition","no screen > ",e.screen)}},_renderDropOffEvent:function(e,t,s,i,o,n,a){var r=this,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"%",h=i.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);h.style.left=Math.round(e)+"px",h.style.top=Math.round(t)+"px";var c=i.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent"+s).build(h),d=Math.max(5,Math.round(n));return c.style.width=d+"px",c.style.height=d+"px",c.style.top=-1*Math.round(d/2)+"px",c.style.left=-1*Math.round(d/2)+"px",c.style.background=o,this.tempOwn((0,g.Z)(c,"click",(function(e){return r.selectDropOffPoint(e)}))),l&&i.span("MatcAnalyticCanvasEventLabel",a+l).build(c),c},selectDropOffPoint:function(){}},mounted:function(){}},Ne=Re,Fe=(0,E.Z)(Ne,Ee,Ve,!1,null,null,null),Ue=Fe.exports,Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"})},Ie=[],$e=s(56505),ze={name:"DataProcessing",mixins:[],data:function(){return{}},components:{},methods:{getOutlierScores:function(){if(!this.cache["outliers"]){var e=new W.Z(this.events),t=$e.by(e,2);this.cache["outliers"]=t}return this.cache["outliers"]},getGestures:function(){if(!this.cache["gestures"]){var e=new W.Z(this.events),t=e.select("type","in",["ScreenGesture","WidgetGesture"]);this.cache["gestures"]=t.data}return this.cache["gestures"]},getUserJourney:function(){if(!this.cache["userJourney"]){var e=new W.Z(this.events);e.sortBy("time");var t=e.groupBy("session"),s=t.data;this.cache["userJourney"]=s}return this.cache["userJourney"]},getTaskPerformance:function(){if(!this.cache["taskPerformance"]){var e=new N.Z,t=new W.Z(this.events);t.sortBy("time");for(var s=e.getTaskPerformance(t,this.testSettings.tasks,!1,!1),i={},o=0;o<s.data.length;o++){var n=s.data[o];i[n.session]||(i[n.session]={}),i[n.session][n.task]?console.warn("getTaskPerformance() Double mactch",n):i[n.session][n.task]=n}this.cache["taskPerformance"]=i}return this.cache["taskPerformance"]},getOverlayViews:function(){if(!this.cache["overlayViews"]){for(var e=this.df.select("type","==","OverlayLoaded"),t=e.count("overlay"),s=e.size(),i={},o=this.getScreens(this.sourceModel),n=0;n<o.length;n++){var a=o[n];i[a.id]=t.get(a.id,null,0)}this.cache["overlayViews"]={total:s,counts:i}}return this.cache["overlayViews"]},getOverlayTest:function(){if(!this.cache["overlayTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),s={},i=this.getScreens(this.sourceModel),o=0;o<i.length;o++){var n=i[o];s[n.id]=0}e.foreach((function(e){var t=e.count("overlay");t.foreach((function(e,t){s[t]+=1}))})),this.cache["overlayTests"]={sessions:t,counts:s}}return this.cache["overlayTests"]},getScreenViews:function(){if(!this.cache["screenViews"]){for(var e=this.df.select("type","==","ScreenLoaded"),t=e.count("screen"),s=e.size(),i={},o=this.getScreens(this.sourceModel),n=0;n<o.length;n++){var a=o[n];i[a.id]=t.get(a.id,null,0)}this.cache["screenViews"]={total:s,counts:i}}return this.cache["screenViews"]},getScreenTests:function(){if(!this.cache["screenTests"]){for(var e=this.df.groupBy("session"),t=e.size().size(),s={},i=this.getScreens(this.sourceModel),o=0;o<i.length;o++){var n=i[o];s[n.id]=0}e.foreach((function(e){var t=e.count("screen");t.foreach((function(e,t){s[t]+=1}))})),this.cache["screenTests"]={sessions:t,counts:s}}return this.cache["screenTests"]},getScreenDwellTime:function(){if(!this.cache["screenDwell"]){for(var e=this.df.count("session"),t=e.size(),s=new N.Z,i=s.getScreenTimeGrouping(this.df),o=i.sum().sum(),n={},a=this.getScreens(this.sourceModel),r=0;r<a.length;r++){var l=a[r],h=i.get(l.id);n[l.id]=h?h.sum():0}this.cache["screenDwell"]={total:o,times:n,sessions:t}}return this.cache["screenDwell"]},getOverlayDwellTime:function(){if(!this.cache["overlayDwell"]){for(var e=this.df.count("session"),t=e.size(),s=new N.Z,i=s.getScreenTimeGrouping(this.df),o=i.sum().sum(),n=s.getOverlayTimeGrouping(this.df),a={},r=this.getScreens(this.sourceModel),l=0;l<r.length;l++){var h=r[l],c=n.get(h.id);a[h.id]=c?c.sum():0}this.cache["overlayDwell"]={total:o,times:a,sessions:t}}return this.cache["overlayDwell"]},getScreenWidgetClicks:function(){if(!this.cache["screenWidgetClicks"]){var e=this.df.select("type","==","WidgetClick"),t=e.count("screen"),s=t.sum();e=e.select("overlay","==",null),t=e.count("screen");for(var i={},o=this.getScreens(this.sourceModel),n=0;n<o.length;n++){var a=o[n];i[a.id]=t.get(a.id,null,0)}this.cache["screenWidgetClicks"]={clicks:i,total:s}}return this.cache["screenWidgetClicks"]},getScreenClicksOnBackground:function(){if(!this.cache["screenClicksOnBackground"]){var e=this.df.select("type","==","ScreenClick");this.cache["screenClicksOnBackground"]=e}return this.cache["screenClicksOnBackground"]},getMissedClicks:function(){var e=this;if(!this.cache["missedClicks"]){var t=Object.values(this.sourceModel.screens),s={};t.forEach((function(t){var i=e.getFromLines(t);0===i.length&&(s[t.id]=!0)}));var i=[],o=Object.values(this.sourceModel.widgets);o.forEach((function(t){if("Box"===t.type||"Button"===t.type||"HotSpot"===t.type){var s=e.getFromLines(t);0===s.length&&(i[t.id]=!0)}}));var n=this.df.select("type","in",["ScreenClick","WidgetClick"]).as_array(),a=n.filter((function(e){return"ScreenClick"===e.type&&!0===s[e.screen]||"WidgetClick"===e.type&&!0===i[e.widget]}));this.cache["missedClicks"]=a}return this.cache["missedClicks"]},getScreenClicks:function(){if(!this.cache["screenClicks"]){for(var e=this.df.select("type","in",["ScreenClick","WidgetClick"]),t=e.count("screen"),s=t.sum(),i=this.df.select("type","==","ScreenClick"),o=i.count("screen"),n={},a=this.getScreens(this.sourceModel),r=0;r<a.length;r++){var l=a[r];n[l.id]=o.get(l.id,null,0)}this.cache["screenClicks"]={clicks:n,total:s}}return this.cache["screenClicks"]},getOverlayClicks:function(){if(!this.cache["overlayCicks"]){for(var e=this.df.select("type","==","ScreenClick"),t=e.count("overlay"),s=t.sum(),i={},o=this.getScreens(this.sourceModel),n=0;n<o.length;n++){var a=o[n];i[a.id]=t.get(a.id,null,0)}this.cache["overlayCicks"]={clicks:i,total:s}}return this.cache["overlayCicks"]},getOverlayWidgetClicks:function(){if(!this.cache["overlayWidgetCicks"]){for(var e=this.df.select("type","==","WidgetClick"),t=e.count("overlay"),s=t.sum(),i={},o=this.getScreens(this.sourceModel),n=0;n<o.length;n++){var a=o[n];i[a.id]=t.get(a.id,null,0)}this.cache["overlayWidgetCicks"]={clicks:i,total:s}}return this.cache["overlayWidgetCicks"]},getLineWidgetData:function(){var e=this;return this.cache["lineWidgetData"]||function(){var t={},s=e.getWidgetData(),i=0;for(var o in e.model.lines){var n=e.model.lines[o].from;if(s[n]){var a=s[n].clicksAbs;t[n]={clicksAbs:a},i=Math.max(i,a)}Object.values(t).forEach((function(e){e.clicksRel=e.clicksAbs/i}))}e.cache["lineWidgetData"]=t}(),this.cache["lineWidgetData"]},getWidgetData:function(){if(!this.cache["widgetData"]){var e=new N.Z,t={},s=e.getWidgetStatistics(this.sourceModel,this.df);for(var i in s)t[i]=s[i];this.cache["widgetData"]=t}return this.cache["widgetData"]},getFirstNClicksData:function(e){var t="firstClicks"+e;if(!this.cache[t]){var s=new N.Z;this.cache[t]=s.getFirstNClicks(this.events,e)}return this.cache[t]}},mounted:function(){}},je=ze,Je=(0,E.Z)(je,Ge,Ie,!1,null,null,null),Ke=Je.exports,qe={name:"AnalyticCanvas",mixins:[r.Z,de.Z,w.Z,C.Z,ge.Z,ve.Z,me.Z,pe.Z,fe.Z,Me.Z,Ce.Z,we.Z,ye.Z,Se.Z,be.Z,Ze.Z,Te.Z,De.Z,ke.Z,ue.Z,He,Ue,Ke],data:function(){return{mode:"view",zoom:.5,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1,isBlackAndWhite:!1,dropOffLineWidth:25,dropOffLineColor:"#555",dropOffEventWidth:40,userJourneyEndColor:"#f03131"}},components:{},methods:{postCreate:function(){this.logger=new y.Z("AnalyticCanvas"),this.logger.log(2,"constructor","entry"),this.cache={},this.moveMode="classic",this.domUtil=new _e.Z,this.analyticLines={},this.analyticCircles={},this.logger.log(2,"postCreate","entry"),this.initSize(),this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initContainerSize(),this.setContainerPos(),this.initSelection(),this.initRender(),this.initAnalyticSVG(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initWiring(),this.initKeys(),this.initMouseTracker(),this.db=new S.Z,this.own(ce.Z.subscribe("matc/toolbar/click",u.Z.hitch(this,"onToolbarClick"))),this.own((0,g.Z)(he.Z.body(),"keydown",u.Z.hitch(this,"onKeyPress"))),this.own((0,g.Z)(he.Z.body(),"keyup",u.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},showError:function(e){this.message&&(l.Z.add(this.message,"MatcMessageError"),l.Z.remove(this.message,"MatcMessageSuccess MatcMessageHint"),this.message.textContent=e,setTimeout(u.Z.hitch(this,"hideMessage"),3e3))},XlineFunction:function(e){return this.straightLineFunction(e)},setPublic:function(e){this.isPublic=e},setModelService:function(e){this.sourceModelService=e},setCommentService:function(e){this.commentService=e},setToolbar:function(e){this.toolbar=e,this.onChangeCanvasViewConfig()},setMouseListener:function(e){this.mouseListenerCallback=e},inlineEditInit:function(){this.logger.log(2,"inlineEditInit","enter")},setMouseData:function(e){this.logger.log(0,"setMouseData","enter > "+e.length),this.mouseData=e,0==e.length&&this.showError("No Mouse data was recorded")},setBW:function(e){this.logger.log(1,"setBW","enter > "+e),e?l.Z.add(this.container,"MatcCanvasBW"):l.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig:function(){this.toolbar&&this.toolbar.setCanvasViewConfig({zoom:this.zoom,renderLines:this.renderLines,showComments:this.showComments,isBlackAndWhite:this.isBlackAndWhite})},setCanvasViewConfig:function(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t),"zoom"===e&&this.setZoomFactor(t),"renderLines"===e&&this.setViewLines(t),"showComments"===e&&this.setCommentView(t),"isBlackAndWhite"===e&&(this.isBlackAndWhite=t,this.setBW(t))},initAnalyticSVG:function(){this.logger.log(3,"initAnalyticSVG","entry");var e=xe.Ys(this.svgContainer);this.analyticSVG=e.append("svg").attr("width",this.canvasPos.h).attr("height",this.canvasPos.w)},cleanUpAnalyticLines:function(){this.analyticSVG&&this.analyticSVG.selectAll("*").remove(),this.analyticLines={},this.analyticCircles={}},drawLine:function(e,t){var s=this.defaultLineColor,i=this.defaultLineWidth;if(this.model&&this.model.lines&&this.model.lines[e]){var o=this.model.lines[e],n=this.getLineWidgetData();if(n[o.from]){var a=n[o.from],r=a.clicksRel;s=this.mixColor(r)}}return this.drawSVGLine(e,t,s,i,1)},drawAnalyticLine:function(e,t,s,i,o){var n=this.analyticSVG.append("path").attr("d",this.lineFunction(t)).attr("stroke",s).attr("stroke-width",i).attr("fill","none").style("opacity",o);this.analyticLines[e]=n},drawStraightAnalyticLine:function(e,t,s,i,o){var n=this.analyticSVG.append("path").attr("d",this.straightLineFunction(t)).attr("stroke",s).attr("stroke-width",i).attr("fill","none").style("opacity",o);this.analyticLines[e]=n},initWiring:function(){var e=this;this.logger.log(-1,"initWiring","enter"),this.own((0,g.Z)(this.dndContainer,"mousedown",(function(t){return e.dispatchMouseDown(t)})))},dispatchMouseDownScreen:function(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t);var s=this.screenDivs[t],i=this.model.screens[t];this.onScreenDndClick(i.id,s,null)},dispatchMouseDownWidget:function(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);var s=this.widgetDivs[t];this.onWidgetDndClick(t,s)},afterUpdateDnd:function(e){this.logger.log(1,"afterUpdateDnd","enter > ",e)},initSettings:function(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#333",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings:function(){return this.settings},setSettings:function(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings:function(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineColor&&(this.defaultLineColor=e.lineColor),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&(this._lastCanvasTheme&&l.Z.remove(he.Z.body(),this._lastCanvasTheme),l.Z.add(he.Z.body(),e.canvasTheme),this._lastCanvasTheme=e.canvasTheme,"MatcLight"==e.canvasTheme?this.defaultLineColor="#777":this.defaultLineColor="#333"),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},onWidgetDndClick:function(e,t,s,i){this.logger.log(2,"onWidgetDndClick","enter > "+e),this.stopEvent(i),this.onWidgetSelected(e),this.selectAnalyticDiv(e),this.setState(0)},onScreenDndClick:function(e,t,s,i){this.logger.log(2,"onScreenDndClick","entry > "+e),this.stopEvent(i),this.setSelectedScreens([e]),this.selectAnalyticDiv(e),this.setState(0)},onCanvasSelected:function(){this.logger.log(2,"onCanvasSelected","entry > "),this.selectAnalyticDiv(null),this.toolbar&&(this.toolbar.unselect(),"HeatmapClick"===this.analyticMode&&this.toolbar.reShowClickHeatMap())},selectAnalyticDiv:function(e){if(this._analyticLastSelectedDiv&&(l.Z.remove(this._analyticLastSelectedDiv,"MatcHeapMapWidgetSelected"),delete this._analyticLastSelectedDiv),this.analyticsDivs&&this.analyticsDivs[e]){var t=this.analyticsDivs[e];l.Z.add(t,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=t}if(this.widgetDivs&&this.widgetDivs[e]){var s=this.widgetDivs[e];l.Z.add(s,"MatcHeapMapWidgetSelected"),this._analyticLastSelectedDiv=s}},renderLayerList:function(){this.logger.log(1,"renderLayerList","entry > ")},afterRender:function(){this.logger.log(1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics();try{this._renderHeatMap()}catch(e){this.logger.error("afterRender","Could not render heatmaps ",e),this.logger.sendError(e)}},hasSelect:function(){return"addComment"!=this.mode},_renderHeatMap:function(){this.logPageView("/analytics/workspace/"+this.analyticMode+".html"),this.setBW(this.isBlackAndWhite),this.cleanUpHeat(),"smartphone"==this.sourceModel.type||"tablet"==this.sourceModel.type?(this.defaultRadius=this.sourceModel.screenSize.w/20,this.defaultBlur=this.sourceModel.screenSize.w/15):(this.defaultRadius=this.sourceModel.screenSize.w/120,this.defaultBlur=this.sourceModel.screenSize.w/100),this.logger.log(0,"onScreenRendered","adjust radios to "+this.defaultRadius);var e=this.df.groupBy("screen");for(var t in this.heatmapDivs={},this.sourceModel.screens){var s=this.sourceModel.screens[t],i=e.get(t),o=[];if(i&&(o=i.as_array()),this["_render_"+this.analyticMode]){var n=this.createBox(s);l.Z.add(n,"MatcHeatMapScreen");var a=this.db.div("MatcHeapMapContainer").build(n),r=this.db.canvas(s.w,s.h).build(a),h=r.getContext("2d");this["_render_"+this.analyticMode](o,s,h,n),this.hasSelect()&&this.tempOwn((0,g.Z)(n,f.Z.press,u.Z.hitch(this,"onScreenDndClick",s.id,n,null))),this.widgetContainer.appendChild(n),this.heatmapDivs[s.id]=n,this.analyticsDivs[s.id]=n}}"UserJourney"!=this.analyticMode&&"Gesture"!=this.analyticMode&&"DropOff"!=this.analyticMode?this.hideWidgetDND=!0:this.hideWidgetDND=!1,this["_render_global_"+this.analyticMode]&&this["_render_global_"+this.analyticMode](o,s,h,n)},_render_HeatmapMouse:function(e,t,s){this.logger.log(0,"_render_HeatmapMouse","entry > "+t.name);var i=this.mouseData.filter((function(e){return e.screen===t.id})),o=this.computeMouseDistribution(i,this.sourceModel);if(o[t.id]){var n=o[t.id];this.draw(s,n.values,n.max,t.w,t.h)}},_render_HeatmapClick:function(e,t,s,i){this.logger.log(2,"_render_HeatmapClick","entry > ");var o=-1;if(this.analyticParams&&(o=this.analyticParams.numberOfClicks),"screenClicks"===o){var n=this.getScreenClicksOnBackground();n=n.as_array(),this._render_pixel_screen_heatmap(n,t,s,i)}else if("missedClicks"===o){var a=this.getMissedClicks();this._render_pixel_screen_heatmap(a,t,s,i)}else if(o>0){var r=this.getFirstNClicksData(o);this._render_pixel_screen_heatmap(r,t,s,i)}else{var l=this.getClickEvents(new W.Z(this.events)),h=l.as_array();this._render_pixel_screen_heatmap(h,t,s,i)}},_render_pixel_screen_heatmap:function(e,t,s){if(t.w<=0||t.h<=0)this.logger.error("_render_pixel_screen_heatmap","Error > bad screen dimension: "+t.name);else try{for(var i=[],o=0;o<e.length;o++){var n=e[o],a=this.getEventScreenId(n);a==t.id&&i.push(n)}var r=this.computeClickDistribution(i,t.w,t.h);this.draw(s,r.values,r.max,t.w,t.h)}catch(l){this.logger.error("_render_pixel_screen_heatmap","Error > "+t.name)}},_render_HeatmapScrollView:function(e,t,s){this.logger.log(2,"_render_HeatmapScrollView","entry > ");var i=this.computeScrollVisibiltyDistribution(e,this.sourceModel.screenSize.h,t.h);this.drawSections(i,s,t.h,t.w)},_render_HeatmapScrollTime:function(e,t,s){this.logger.log(2,"_render_HeatmapScrollTime","entry > ");var i=this.computeScrollDurationDistrubtion(e,this.sourceModel.screenSize.h,t.h);this.drawSections(i,s,t.h,t.w)},_render_HeatmapViews:function(e,t,s){if(this.logger.log(2,"HeatmapViews","entry > "),t.style.overlay){var i=this.getOverlayViews(),o=i.counts[t.id];o||(o=0),s.globalAlpha=.4;var n=this.mixColor(o/i.total);s.fillStyle=n,s.fillRect(0,0,t.w,t.h)}else{var a=this.getScreenViews(),r=a.counts[t.id];r||(r=0),s.globalAlpha=.4;var l=this.mixColor(r/a.total);s.fillStyle=l,s.fillRect(0,0,t.w,t.h)}},_render_HeatmapDwelTime:function(e,t,s){if(this.logger.log(2,"HeatmapDwelTime","entry > "),t.style.overlay){var i=this.getOverlayDwellTime(),o=i.times[t.id];o||(o=0),s.globalAlpha=.4;var n=this.mixColor(o/i.total);s.fillStyle=n,s.fillRect(0,0,t.w,t.h)}else{var a=this.getScreenDwellTime(),r=a.times[t.id];r||(r=0),s.globalAlpha=.4;var l=this.mixColor(r/a.total);s.fillStyle=l,s.fillRect(0,0,t.w,t.h)}},drawDurationLine:function(e,t,s,i){for(var o=0;o<t.length-1;o++){var n=t[o],a=t[o+1],r=a.duration/i,l=Math.round(6*r)+2,h=s;this.drawStraightAnalyticLine(e,[n,a],h,l,this.taskLineOpacity)}},_render_global_Gesture:function(){this.logger.log(0,"_render_global_Gesture","entry > ");for(var e=this.getGestures(),t=new S.Z,s=0;s<e.length;s++){var i=e[s],o=i.gesture,n=this.getEventScreenId(i),a=this.sourceModel.screens[n];if(a&&o){var r=[],l=i.gesture.start,h=i.gesture.end;if(l&&h){var c=l.x*a.w+a.x,d=l.y*a.h+a.y;r.push({x:c,y:d,d:"right"}),this._renderGestureStart(c,d,this.analyticParams.color,t),c=h.x*a.w+a.x,d=h.y*a.h+a.y,r.push({x:c,y:d,d:"right"});var u=Math.max(1,Math.round(3*this.zoom));this.drawSVGLine("",r,this.analyticParams.color,u,1)}}else console.warn("_render_global_Gesture()","Screen is not there",i.screen)}},_renderGestureStart:function(e,t,s,i){var o=i.div("MatcAnalyticCanvasEventCntr").build(this.widgetContainer);o.style.left=Math.round(e)+"px",o.style.top=Math.round(t)+"px";var n=i.div("MatcAnalyticCanvasEvent MatcAnalyticCanvasEvent").build(o),a=Math.max(5,Math.round(15*this.zoom));return n.style.width=a+"px",n.style.height=a+"px",n.style.top=-1*Math.round(a/2)+"px",n.style.left=-1*Math.round(a/2)+"px",n.style.backgroundColor=s,n},cleanUpAnalytics:function(){this.cleanUpAnalyticLines(),this.cleanUpNode(this.widgetContainer),this.analyticsDivs={}},setController:function(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController:function(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback:function(e){this._controllerCallback=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory:function(e){this.logger.log(3,"setRenderFactory","enter"),this.renderFactory=e},setModel:function(e){this.sourceModel=e,this.grid=this.sourceModel.grid,this.loadComments()},setEvents:function(e){this.logger.log(1,"setEvents","enter > # "+e.length);var t=new N.Z;this.events=t.nornalizeContainerChildEvents(e),this.df=new W.Z(e),this.df.sortBy("time"),this.fixGestures(e)},setAnnotation:function(e){this.logger.log(2,"setAnnotation","enter > # "),this.annotation=e},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setAnalyticMode:function(e,t){this.logger.log(2,"setAnalyticMode","entry > mode: "+e),this.analyticMode=e,this.analyticParams=t,this.rerender(),this.analyticCSS&&l.Z.remove(this.domNode,this.analyticCSS),this.analyticCSS=e,l.Z.add(this.domNode,this.analyticCSS)},setUser:function(e){this.user=e},setMode:function(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this.mode+" > "+t),e!=this.mode?(this.mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},onKeyPress:function(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!l.Z.contains(t,"MatcIgnoreOnKeyPress")){var s=e.keyCode?e.keyCode:e.which;32==s?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.setMode("move"),this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0))):37==s?this.onArrowLeft():39==s?this.onArrowRight():40==s?this.onArrowDown():38==s?this.onArrowUp():171==s||187==s?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=s&&189!=s||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},getMode:function(){return this.mode},onKeyUp:function(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initMouseTracker:function(){this.own((0,g.Z)(he.Z.body(),"mousemove",u.Z.hitch(this,"onMouseMove")))},onMouseMove:function(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy:function(){this.cleanUp()},logPageView:function(e){this.logger.log(4,"logPageView","enter",e)}},mounted:function(){}},Xe=qe,Qe=(0,E.Z)(Xe,re,le,!1,null,null,null),Ye=Qe.exports,et=s(76133),tt=s(92751),st=s(99418),it=s(49161),ot=s(768),nt=s(96722),at=function(e){(0,st.Z)(s,e);var t=(0,it.Z)(s);function s(){var e;return(0,et.Z)(this,s),e=t.call(this),e.logger=new y.Z("AnalyticController"),e.logger.log(2,"constructor","exit"),e}return(0,tt.Z)(s,[{key:"setModelService",value:function(e){this.modelService=e}},{key:"setCanvas",value:function(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}},{key:"setToolbar",value:function(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}},{key:"setModelFactory",value:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}},{key:"setModel",value:function(e,t){this.logger.log(2,"setModel","entry > "+t),this.model=e,this.inheritedModel=this.createInheritedModel(e),this.inheritedModel=ot.Z.addContainerChildrenToModel(this.inheritedModel),this.oldModel=u.Z.clone(e),this.render(t),this.toolbar?this.toolbar.setModel(e):console.debug("No toolbar in controller!"),this._canvas&&this._canvas.setFonts(e.fonts),this.logger.log(3,"setModel","entry > "+t)}},{key:"setMode",value:function(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar.setMode(e),this._canvas.setMode(e)}},{key:"setSinglePage",value:function(e){this.logger.log(0,"setSinglePage","entry > "+e)}},{key:"getZoomFactor",value:function(){return this._canvas?this._canvas.getZoomFactor():1}},{key:"render",value:function(e){var t=this;if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){var s=nt.Z.createInheritedModel(this.model);requestAnimationFrame((function(){t._canvas.render(s),e&&t._canvas.moveToScreen(e)}))}}},{key:"_requestRendering",value:function(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}},{key:"_zoomToScreen",value:function(e){if(e&&this.model.screens[e]){var t=this.model.screens[e],s=h.Z.getBox(),i=s.w/t.w,o=s.h/t.h,n=Math.floor(10*Math.min(i,o))/10-.2;this._canvas.setZoom(n)}}},{key:"onWidgetSelected",value:function(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}},{key:"onScreenSelected",value:function(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}},{key:"onCanvasSelected",value:function(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}},{key:"onLineSelected",value:function(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}},{key:"onMultiSelect",value:function(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}},{key:"onGroupSelected",value:function(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}},{key:"unSelect",value:function(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}},{key:"showSuccess",value:function(e){this._canvas&&this._canvas.showSuccess(e)}},{key:"showError",value:function(e){this._canvas&&this._canvas.showError(e)}}]),s}(ot.Z),rt={name:"Design",mixins:[r.Z],data:function(){return{}},components:{AnalyticToolbar:ae,AnalyticCanvas:Ye},computed:{isPublic:function(){return this.$route.meta&&this.$route.meta.isPublic}},methods:{loadData:function(){var e=this,t=this.$route.params.id;this.logger.log(0,"loadData","enter",t),Promise.all([this.modelService.findApp(t),this.modelService.findTest(t),this.modelService.findEvents(t),this.modelService.findSessionAnnotations(t),this.modelService.findInvitation(t)]).then((function(t){var s=t[4],i={};for(var o in s)i[s[o]]=o;var n=i[1];e.buildCanvas(t[0],t[1],t[2],t[3],n)}))},buildCanvas:function(e,t,s,i,o){this.logger.log(-1,"buildCanvas","enter",o);var n=this.$refs.canvas,a=this.$refs.toolbar,r=new at,l=v.Z.getModelService(),h=new c.Z;h.setModel(e);var m=new d.Z;m.setModel(e),m.setHash(o),r.setModelService(l),r.setToolbar(a),r.setModelFactory(h),a.setController(r),a.setCanvas(n),a.setUser(this.user),a.setModelFactory(h),a.setModelService(l),a.setEvents(s),a.setAnnotation(i),a.setTest(t),a.setPublic(this.isPublic),n.setController(r),n.setToolbar(a),n.setRenderFactory(m),n.setModelFactory(h),n.setCommentService(v.Z.getCommentService()),n.setUser(this.user),n.setEvents(s),n.setAnnotation(i),n.setTest(t),this.tempOwn((0,g.Z)(a,"newComment",u.Z.hitch(n,"addComment")));var p=null;for(var f in e.screens){var M=e.screens[f];if(M.props&&M.props.start){p=f;break}}r.setModel(e,p)}},mounted:function(){var e=this;return(0,a.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger=new y.Z("Analyze"),l.Z.add(h.Z.body(),"MatcVisualEditor"),t.next=4,v.Z.getUserService().load();case 4:e.user=t.sent,e.modelService=v.Z.getModelService(e.$route),e.loadData(),e.logger.log(3,"mounted","exit");case 8:case"end":return t.stop()}}),t)})))()}},lt=rt,ht=(0,E.Z)(lt,i,o,!1,null,null,null),ct=ht.exports},89225:function(e,t,s){s.r(t),s.d(t,{default:function(){return D}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasPage",attrs:{id:"CanvasNode"},on:{wheel:e.onMouseWheel}},[s("Toolbar",{ref:"toolbar",attrs:{pub:e.pub}}),s("Canvas",{ref:"canvas"})],1)},o=[],n=s(67906),a=s(16198),r=(s(41539),s(78783),s(33948),s(60245)),l=s(28379),h=s(78651),c=s(52469),d=s(14962),u=s(42805),g=s(24246),v=s(9723),m=s(59344),p=s(48039),f=s(77259),M=s(54524),C=s(76133),w=s(92751),y=(s(69826),s(57327),s(43918)),S=function(){function e(t){(0,C.Z)(this,e),this.user=t,this.collabUsers=[]}return(0,w.Z)(e,[{key:"initWebsocket",value:function(e,t,s,i){var o=this;y.Z.log(3,"CollabSession.initWebsocket()","enter");try{var n=this.user,a=f.Z.getWebSocketService(e.id,n.token,n);a?(a.onMessage((function(e){return o.dispatchWebSocketMessage(t,s,i,n,e)})),a.init((function(e){e&&o.sendHello(),t.setMouseListener((function(e){o.sendMouse(e)})),s.setModelChangeListener((function(e){o.sendChange(e)}))})),this.websocket=a):y.Z.log(1,"CollabSession.initWebsocket()","exit > No session created")}catch(r){y.Z.error("CollabSession.initWebsocket()","Cannot init WebSocket",r)}}},{key:"hasOtherUsers",value:function(){var e=this,t=this.collabUsers.find((function(t){return t.id!==e.user.id}));return void 0!==t}},{key:"sendChange",value:function(e){y.Z.log(1,"CollabSession.sendChange()","enter",e),this.websocket&&this.hasOtherUsers()?(y.Z.log(2,"CollabSession.sendChange()","send",e),this.websocket.send({type:"change",changeEvent:e})):y.Z.log(2,"CollabSession.sendChange()","NOT SEND")}},{key:"sendMouse",value:function(e){this.websocket&&this.hasOtherUsers()&&this.websocket.send({type:"mouse",pos:e})}},{key:"sendBye",value:function(){y.Z.log(-1,"CollabSession.sendBye()","enter"),this.websocket&&this.websocket.send({type:"bye"})}},{key:"sendHello",value:function(){y.Z.log(2,"CollabSession.sendHello()","enter"),this.websocket&&this.websocket.send({type:"hello"})}},{key:"sendImHere",value:function(){y.Z.log(2,"CollabSession.sendImHere()","enter"),this.websocket&&this.websocket.send({type:"imhere"})}},{key:"dispatchWebSocketMessage",value:function(e,t,s,i,o){"hello"===o.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","hello"),s.addCollabUser(o.user),e.addCollabUser(o.user),this.addCollabUser(o.user),this.sendImHere()),"imhere"===o.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","imhere"),s.addCollabUser(o.user),e.addCollabUser(o.user),this.addCollabUser(o.user)),"bye"===o.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","bye"),s.removeCollabUser(o.user),e.removeCollabUser(o.user),this.removeCollabUser(o.user)),"mouse"===o.type&&e.setCollabMouse(o.user,o.pos),"change"===o.type&&(y.Z.log(2,"CollabSession.dispatchWebSocketMessage()","change"),t.collabRecieveChanges(o.user,o.changeEvent))}},{key:"addCollabUser",value:function(e){y.Z.log(1,"CollabSession.addCollabUser()",e);var t=this.collabUsers.find((function(t){return t.id===e.id}));t||this.collabUsers.push(e)}},{key:"removeCollabUser",value:function(e){y.Z.log(1,"CollabSession.removeCollabUser()",e),this.collabUsers=this.collabUsers.filter((function(t){return t.id!==e.id}))}},{key:"close",value:function(){y.Z.log(1,"CollabSession.dispatchWebSocketMessage()","close"),this.websocket&&this.websocket.close()}}]),e}(),b={name:"Design",mixins:[r.Z],data:function(){return{}},components:{Toolbar:c.Z,Canvas:d.Z},computed:{pub:function(){return this.$route.meta&&this.$route.meta.isPublic},mode:function(){return this.pub?"public":"private"}},methods:{onMouseWheel:function(e){e&&Math.abs(e.deltaX)>50&&(this.logger.log(-1,"onMouseWheel","cancel"),e.preventDefault())},loadData:function(){var e=this,t=this.$route.params.id;this.logger.log(3,"loadData","enter",t),Promise.all([this.modelService.findApp(t),this.modelService.getCommands(t),this.modelService.findInvitation(t)]).then((function(t){var s=t[2],i={};for(var o in s)i[s[o]]=o;var n=i[1];e.buildCanvas(t[0],t[1],n)}))},buildCanvas:function(e,t,s){var i=this;this.logger.log(3,"buildCanvas","enter");var o=this.$refs.canvas,n=this.$refs.toolbar,a=new u.Z,r=this.modelService,l=new g.Z;l.setModel(e);var h=new v.Z;h.setModel(e),h.setHash(s),a.setModelService(r),a.setToolbar(n),a.setModelFactory(l),this.pub&&(a.setPublic(!0),o.setPublic(!0),n.setPublic(!0)),n.setController(a),n.setCanvas(o),n.setUser(this.user),n.setModelFactory(l),n.setContext(this.context),n.setHash(s),o.setController(a),o.setToolbar(n),o.setRenderFactory(h),o.setModelFactory(l),o.setModelService(r),o.setCommentService(f.Z.getCommentService()),o.setUser(this.user),this.tempOwn((0,p.Z)(n,"newScreen",m.Z.hitch(o,"addScreen"))),this.tempOwn((0,p.Z)(n,"newWidget",m.Z.hitch(o,"addWidget"))),this.tempOwn((0,p.Z)(n,"newLine",m.Z.hitch(o,"addLine"))),this.tempOwn((0,p.Z)(n,"newComment",m.Z.hitch(o,"addComment"))),this.tempOwn((0,p.Z)(n,"newTemplatedWidget",m.Z.hitch(o,"addTemplatedWidget"))),this.tempOwn((0,p.Z)(n,"newTemplatedScreen",m.Z.hitch(o,"addTemplatedScreen"))),this.tempOwn((0,p.Z)(n,"newTemplatedGroup",m.Z.hitch(o,"addTemplatedGroup"))),this.tempOwn((0,p.Z)(n,"newThemedScreen",m.Z.hitch(o,"addThemedScreen"))),this.tempOwn((0,p.Z)(n,"newThemedGroup",m.Z.hitch(o,"addThemedGroup"))),this.tempOwn((0,p.Z)(n,"newThemedWidget",m.Z.hitch(o,"addThemedWidget"))),this.tempOwn((0,p.Z)(n,"newMultiThemedScreen",m.Z.hitch(o,"addMultiThemedScreens"))),this.tempOwn((0,p.Z)(n,"newThemedScreenAndWidget",m.Z.hitch(o,"addThemedScreenAndWidgets"))),this.tempOwn((0,p.Z)(n,"newImportApp",m.Z.hitch(o,"addImportedApp"))),this.tempOwn((0,p.Z)(n,"onNewLogicObject",m.Z.hitch(o,"addLogicGroup"))),this.tempOwn((0,p.Z)(n,"onNewRestObject",m.Z.hitch(o,"addRestObject"))),this.tempOwn((0,p.Z)(n,"onNewScriptObject",m.Z.hitch(o,"addScriptObject"))),this.tempOwn((0,p.Z)(n,"onNewSVG",m.Z.hitch(o,"addSVG"))),this.tempOwn((0,p.Z)(n,"onEditSVG",m.Z.hitch(o,"openSVGEditor"))),a.setCommandStack(t),a.setModel(e,this.$route.params.sid),o.initLayer(),this.pub||"guest"===this.user.role||(this.collabSession=new S(this.user),this.collabSession.initWebsocket(e,o,a,n),window.onbeforeunload=function(){i.collabSession.sendBye()})}},beforeDestroy:function(){this.collabSession&&(this.collabSession.sendBye(),this.collabSession.close())},mounted:function(){var e=this;return(0,a.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger=new M.Z("Design"),l.Z.add(h.Z.body(),"MatcVisualEditor"),t.next=4,f.Z.getUserService().load();case 4:e.user=t.sent,e.modelService=f.Z.getModelService(e.$route),e.loadData(),e.logger.log(3,"mounted","exit");case 8:case"end":return t.stop()}}),t)})))()}},k=b,Z=s(1001),T=(0,Z.Z)(k,i,o,!1,null,null,null),D=T.exports},49895:function(e,t,s){s.r(t),s.d(t,{default:function(){return ae}});var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvasPage MatcShare",attrs:{id:"CanvasNode"}},[s("ShareCanvas",{ref:"canvas"})],1)},o=[],n=s(67906),a=s(16198),r=(s(41539),s(78783),s(33948),s(60245)),l=s(28379),h=s(78651),c=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},d=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"MatcCanvas MatcAnalyticCanvas"},[s("div",{staticClass:"MatcCanvasFrame",attrs:{"data-dojo-attach-point":"frame"}},[s("div",{staticClass:"MatcCanvasContainer MatcCanvasZoomable ",attrs:{"data-dojo-attach-point":"container"}},[s("div",{staticClass:"MatcCanvasContainer ",attrs:{"data-dojo-attach-point":"zoomContainer"}},[s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"screenContainer"}}),s("div",{staticClass:"MatcCanvasLayer",attrs:{"data-dojo-attach-point":"widgetContainer"}})]),s("div",{staticClass:"MatcDnDLayer",attrs:{"data-dojo-attach-point":"dndContainer"}})])]),s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarRight",attrs:{"data-dojo-attach-point":"scrollRight"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrRight",attrs:{"data-dojo-attach-point":"scrollRightCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollRightHandler"}})])]),s("div",{staticClass:"MatcCanvasScrollBar MatcCanvasScrollBarBottom",attrs:{"data-dojo-attach-point":"scrollBottom"}},[s("div",{staticClass:"MatcCanvasScrollBarCntr MatcCanvasScrollBarCntrBottom",attrs:{"data-dojo-attach-point":"scrollBottomCntr"}},[s("div",{staticClass:"MatchCanvasScrollHandle",attrs:{"data-dojo-attach-point":"scrollBottomHandler"}})])]),s("div",{staticClass:"MatcMessage",attrs:{"data-dojo-attach-point":"message"}})])}],u=s(54524),g=s(48039),v=s(59344),m=s(16328),p=s(19721),f=s(77050),M=s(17386),C=s(96200),w=s(6848),y=s(85877),S=s(89224),b=s(25282),k=s(17513),Z=s(22578),T=s(22579),D=s(71842),_=s(4803),x=s(73614),L=s(20293),B=s(7611),O=s(81102),P=s(9982),W=s(49685),A=s(30330),H=s(72712),E=s(75840),V=s(70143),R=s(96765),N=s(5403),F=s(97878),U={name:"ShareCanvas",mixins:[r.Z,y.Z,H.Z,b.Z,k.Z,Z.Z,T.Z,D.Z,_.Z,x.Z,L.Z,B.Z,O.Z,P.Z,W.Z,V.Z,R.Z,N.Z,S.Z],data:function(){return{mode:"view",zoom:.4,zoomLevelPos:3,analyticMode:"HeatmapClick",resizeEnabled:!1,renderDND:!0,dragNDropMinTimeSpan:0,wireInheritedWidgets:!0,taskLineOpacity:1}},components:{},methods:{postCreate:function(){this.logger=new u.Z("ShareCanvas"),this.logger.log(2,"postCreate","entry"),this.domUtil=new F.Z,this.initSize(),this.initWiring(),this.cache={},this.moveMode="classic",this.canvasPos={x:this.canvasStartX,y:this.canvasStartY,w:this.canvasFlowWidth,h:this.canvasFlowHeight},this.initContainerSize(),this.setContainerPos(),this.db=new M.Z,this.initSelection(),this.initRender(),this.initZoom(),this.initScrollBars(),this.initComment(),this.initSettings(),this.initMouseTracker(),this.initButtons(),this.own(p.Z.subscribe("matc/toolbar/click",v.Z.hitch(this,"onToolbarClick"))),this.own((0,g.Z)(m.Z.body(),"keydown",v.Z.hitch(this,"onKeyPress"))),this.own((0,g.Z)(m.Z.body(),"keyup",v.Z.hitch(this,"onKeyUp"))),this.logger.log(2,"postCreate","exit!!!")},closeSVGEditor:function(){},setModelService:function(e){this.modelService=e},setCommentService:function(e){this.commentService=e},setPublic:function(e){this.isPublic=e},inlineEditInit:function(){this.logger.log(2,"inlineEditInit","enter")},onZoomMinusClick:function(){var e=Math.round(10*(this.zoom-.1))/10;this.setZoomFactor(e)},onZoomPlusClick:function(){var e=Math.round(10*(this.zoom+.1))/10;this.setZoomFactor(e)},onTogggleLine:function(){this.setViewLines(!this.renderLines)},setBW:function(e){this.logger.log(-1,"setBW","enter > "+e),e?l.Z.add(this.container,"MatcCanvasBW"):l.Z.remove(this.container,"MatcCanvasBW")},onChangeCanvasViewConfig:function(){},setCanvasViewConfig:function(e,t){this.logger.log(-1,"setCanvasViewConfig","enter > "+e,t)},setHash:function(e){this.logger.log(-1,"setHash","entry > ",e),this.hash=e},renderLayerList:function(){this.logger.log(1,"renderLayerList","entry > ")},initButtons:function(){var e=this.db.div("MatcTestCommentButton MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-comment MatcMiddle").build(e),this.own((0,g.Z)(e,"click",v.Z.hitch(this,"onNewComment"))),setTimeout((function(){l.Z.remove(e,"MatcFadeOut")}),1250);var t=this.db.div("MatcTestQRButton  MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-play MatcMiddle").build(t),this.own((0,g.Z)(t,"click",v.Z.hitch(this,"onSimulator"))),setTimeout((function(){l.Z.remove(t,"MatcFadeOut")}),1500);var s=this.db.div("MatcTestQRButton  MatcShareZoomIn MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-plus-outline MatcMiddle").build(s),this.own((0,g.Z)(s,"click",v.Z.hitch(this,"onZoomPlusClick"))),setTimeout((function(){l.Z.remove(s,"MatcFadeOut")}),2e3);var i=this.db.div("MatcTestQRButton MatcShareZoomOut MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-magnify-minus-outline MatcMiddle").build(i),this.own((0,g.Z)(i,"click",v.Z.hitch(this,"onZoomMinusClick"))),setTimeout((function(){l.Z.remove(i,"MatcFadeOut")}),1750);var o=this.db.div("MatcTestQRButton MatcShareLine MatcAnimated MatcFadeOut").build(this.domNode);this.db.span("mdi mdi-vector-line MatcMiddle").build(o),this.own((0,g.Z)(o,"click",v.Z.hitch(this,"onTogggleLine"))),setTimeout((function(){l.Z.remove(o,"MatcFadeOut")}),2250)},loadComments:function(){this.logger.log(0,"loadComments","enter > "+this.hash),this.showComments=!0,this.model?this._doGet("/rest/comments/hash/"+this.hash+"/"+this.model.id+"/ScreenComment.json",v.Z.hitch(this,"onCommentsLoaded")):this.logger.error("loadComments","ERROR > No model")},onNewComment:function(e){this.logger.log(1,"onNewComment","enter > "),this.addComment({event:e,type:"comment"})},onCommentAdded:function(e,t,s){this._onAddDone(),this.setState(0),this.setMode("view"),this.logger.log(0,"onCommentAdded","enter"),this.model&&(this.model.isTryOut?(this.showHint("Register to add comments..."),this._onCommentAdded(e,s,[])):this._doGet("/rest/comments/hash/"+this.hash+"/"+this.model.id+"/ScreenComment.json",v.Z.hitch(this,"_onCommentAdded",e,s)))},saveDNDChange:function(e){this.model&&(this.model.isTryOut?this.showSuccess("Register to comment..."):this._doPost("/rest/comments/hash/"+this.hash+"/"+this.model.id+"/"+e.id+".json",e,"onCommentSaved"))},onSaveComment:function(e,t,s){this.stopEvent(s),t.message=e.value,this.model.isTryOut?this.showSuccess("Register to comment..."):t.id?this._doPost("/rest/comments/hash/"+this.hash+"/"+this.model.id+"/"+t.id+".json",t,"onCommentSaved"):this._doPost("/rest/comments/hash/"+this.hash+"/"+this.model.id,t,"onCommentSaved"),this.stopEvent(s),this.onCloseCommentPopup()},onSimulator:function(e){this.startSimulator(e,this.controller.model)},startSimulator:function(e,t){this.logger.log(1,"startSimulator","enter > ");var s=f.Z.position(m.Z.body()),i=s.h-100;l.Z.add(m.Z.body(),"MatcCanvasSimulatorVisible"),"desktop"==t.type?(s.w=.75*s.w,s.h=.75*s.h,this._showDesktopSimulator(t,s,i)):"tablet"==t.type?this.model.screenSize.w>this.model.screenSize.h?(s.w=.65*s.w,s.h=.65*s.h,this._showMobileTest(t,s,"MatchSimulatorWrapperTablet",i)):(s.w=.35*s.w,s.h=.35*s.h,this._showMobileTest(t,s,"MatchSimulatorWrapperTablet",i)):(s.w=.25*s.w,s.h=.25*s.h,this._showMobileTest(t,s,"MatchSimulatorWrapperMobile",i))},_showDesktopSimulator:function(e,t,s){var i=document.createElement("div");l.Z.add(i,"MatchSimulatorDialog");var o=document.createElement("div");if(l.Z.add(o,"MatchSimulatorContainer"),i.appendChild(o),t=this.getScaledSize(t,"width",e),t.h>s){var n=t.h/s;t.h=t.h/n,t.w=t.w/n}o.style.width=Math.round(t.w)+"px",o.style.height=Math.round(t.h)+"px";var a=this.$new(A.Z,{mode:"debug",logData:!1,hash:this.hash});a.scrollListenTarget="parent";var r=this.$new(w.Z,{canDestroy:!1});r.placeAt(o),a.setScrollContainer(r);var h=new C.Z;h.popup(i,this.simulatorButton),h.own(h.on("close",v.Z.hitch(this,"stopSimulator",a,r)));var c=this._getSimulatorScreen();setTimeout((function(){r.wrap(a.domNode),a.setStartScreen(c),a.setModel(e)}),500),this.enableMouseZoom(!1),this.setState("simulate")},resizeSimualtor:function(e,t,s,i){e.innerHTML="";var o=this._getSimulatorScreen(),n=f.Z.position(m.Z.body());n.w=n.w*s,n.h=n.h*s,n=this.getScaledSize(n,"width",t),e.style.width=Math.round(n.w)+"px",e.style.height=Math.round(n.h)+"px";var a=this.$new(A.Z,{mode:"debug",logData:!1,hash:this.hash});a.scrollListenTarget="parent",a.setStartScreen(o);var r=this.$new(w.Z,{canDestroy:!1});r.placeAt(e),a.setScrollContainer(r),r.wrap(a.domNode),a.setModel(t),i.resize(e)},_showMobileTest:function(e,t,s,i){console.debug("_showMobileTest",i);var o=document.createElement("div");l.Z.add(o,"MatchSimulatorDialog");var n=document.createElement("div");l.Z.add(n,"MatchSimulatorWrapper "),s&&l.Z.add(n,s),o.appendChild(n);var a=document.createElement("div");if(l.Z.add(a,"MatchSimulatorContainer"),t=this.getScaledSize(t,"width",e),t.h>i){var r=t.h/i;t.h=t.h/r,t.w=t.w/r}a.style.width=Math.ceil(t.w)+"px",a.style.height=Math.ceil(t.h)+"px",n.appendChild(a);var h=this.$new(w.Z,{canDestroy:!1});h.placeAt(a);var c=this.$new(A.Z,{mode:"debug",logData:!1,hash:this.hash});c.scrollListenTarget="parent",c.setScrollContainer(h);var d=document.createElement("img");E.Z.getQRCode(this.hash,!1,!1).then((function(e){d.src=e})),l.Z.add(d,"MatcSimulatorQR"),o.appendChild(d);var u=new C.Z;u.popup(o,this.simulatorButton),u.on("close",v.Z.hitch(this,"stopSimulator",c,h));var g=this._getSimulatorScreen();c.setStartScreen(g),setTimeout((function(){h.wrap(c.domNode),c.setModel(e)}),500),this.enableMouseZoom(!1),this.setState("simulate")},stopSimulator:function(e,t){l.Z.remove(m.Z.body(),"MatcCanvasSimulatorVisible"),this.enableMouseZoom(!0),this.setState(0),e&&e.destroy(),t&&t.destroy()},_getSimulatorScreen:function(){return this.getSelectedScreen()?this.getSelectedScreen():this._selectedWidget?this.getParentScreen(this._selectedWidget):void 0},initWiring:function(){var e=this;this.logger.log(-1,"initWiring","enter"),this.own((0,g.Z)(this.dndContainer,"mousedown",(function(t){return e.dispatchMouseDown(t)})))},dispatchMouseDownCanvas:function(e){this.logger.log(1,"dispatchMouseDownCanvas","enter",e,this.mode),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,e)},dispatchMouseDownScreen:function(e,t){this.logger.log(-1,"dispatchMouseDownScreen","enter",t)},dispatchMouseDownWidget:function(e,t){this.logger.log(-1,"dispatchMouseDownWidget","enter",t);var s=this.widgetDivs[t];this.onWidgetDndClick(t,s)},onWidgetDndClick:function(e,t,s,i){this.stopEvent(i),this.logger.log(-1,"onWidgetDndClick","enter > "+e),this.setState(0)},highlightActionWidgets:function(){this.logger.log(2,"highlightActionWidgets","entry > ");var e=[];for(var t in this.model.widgets){var s=this.model.widgets[t];if(s){var i=this.getLinesForWidget(s);if(i){var o=this.analyticsDivs[s.id];o&&(e.push(o),l.Z.add(o,"MatcSimulatorWidgetHightlight"))}}}setTimeout((function(){for(var t=0;t<e.length;t++)l.Z.remove(e[t],"MatcSimulatorWidgetHightlight")}),500)},onScreenDndClick:function(e,t,s,i){this.logger.log(-1,"onScreenDndClick","entry > "+e),this.stopEvent(i),this.highlightActionWidgets(),this.setState(0),this.onCanvasSelected()},onCanvasSelected:function(){this.logger.log(2,"onCanvasSelected","entry > ")},animateToScreen:function(e,t){this.moveToScreen(e),setTimeout((function(){l.Z.remove(t,"MatcShareCanvasAnimatedContainer")}),500)},afterRender:function(){this.logger.log(-1,"afterRender","entry > "+this.analyticMode),this.cleanUpAnalytics()},hasSelect:function(){return"addComment"!=this._mode},cleanUpAnalytics:function(){this.analyticsDivs={}},setController:function(e){this.logger.log(2,"setController","enter"),this.controller=e,e.setCanvas(this)},getController:function(){return this._controllerCallback&&this[this._controllerCallback](),this.controller},setControllerCallback:function(e){this._controllerCallback=e},setModelFactory:function(e){this.logger.log(3,"setModelFactory","enter"),this.factory=e},setRenderFactory:function(e){this.logger.log(0,"setRenderFactory","enter"),this.renderFactory=e},setModel:function(e){this.logger.log(3,"setModel","enter"),this.model=e,this.grid=this.model.grid,this.loadComments()},setTest:function(e){this.logger.log(2,"setTest","enter > # "),this.testSettings=e},setUser:function(e){this.user=e},setMode:function(e,t){this.logger.log(2,"setMode","enter > "+e+" != "+this._mode+" > "+t),e!=this._mode?(this._mode=e,this.toolbar&&this.toolbar.setMode(e),this.rerender()):t&&this.rerender()},getMode:function(){return this._mode},onKeyPress:function(e){if(this._currentKeyEvent=e,"simulate"!=this.state&&"dialog"!=this.state){var t=e.target;if(!l.Z.contains(t,"MatcIgnoreOnKeyPress")){var s=e.keyCode?e.keyCode:e.which;32==s?this._inlineEditStarted||(this.stopEvent(e),"move"!=this.getMode()&&(this.showHint("Move the mouse to move canvas..."),this.onDragStart(this.container,"container","onCanvasDnDStart","onCanvasDnDMove","onCanvasDnDEnd",null,this._lastMouseMoveEvent,!0),this.setMode("move"))):171==s||187==s?this._inlineEditStarted||(this.onClickPlus(),this.stopEvent(e)):173!=s&&189!=s||this._inlineEditStarted||(this.onClickMinus(),this.stopEvent(e))}}},onKeyUp:function(e){var t=e.keyCode?e.keyCode:e.which;32==t&&(this.onDragEnd(this._lastMouseMoveEvent),this.setMode("view")),delete this._currentKeyEvent},initSettings:function(){this.logger.log(1,"initSettings","enter > "),this.settings={canvasTheme:"MatcLight",lineColor:"#999",lineWidth:1,storePropView:!0,moveMode:"ps",mouseWheelMode:"scroll"};var e=this._getStatus("matcSettings");e?(e.canvasTheme,e.lineColor&&(this.settings.lineColor=e.lineColor),e.lineWidth&&(this.settings.lineWidth=e.lineWidth)):this.logger.log(2,"initSettings","exit>  no saved settings"),this.applySettings(this.settings)},getSettings:function(){return this.settings},setSettings:function(e){e.canvasTheme&&(this.settings.canvasTheme=e.canvasTheme),e.lineColor,e.lineWidth&&(this.settings.lineWidth=e.lineWidth),null!=e.storePropView&&(this.settings.storePropView=e.storePropView),null!=e.mouseWheelMode&&(this.settings.mouseWheelMode=e.mouseWheelMode),this._setStatus("matcSettings",this.settings),this.applySettings(this.settings),this.rerender()},applySettings:function(e){this.logger.log(2,"applySettings","enter > "+e.canvasTheme+" &> "+e.moveMode),e.lineWidth&&(this.defaultLineWidth=e.lineWidth),e.canvasTheme&&(this._lastCanvasTheme&&l.Z.remove(m.Z.body(),this._lastCanvasTheme),l.Z.add(m.Z.body(),e.canvasTheme),this._lastCanvasTheme=e.canvasTheme),e.mouseWheelMode&&(this._mouseWheelMode=e.mouseWheelMode),this.settings=e},getLinesForWidget:function(e){e.inherited&&this.model.widgets[e.inherited]&&(e=this.model.widgets[e.inherited]);var t=e.id,s=this.getFromLines(e);if(s&&s.length>0)return s;var i=this.getParentGroup(t);if(i){var o=this.getFromLines(i);if(o&&o.length>0)return o}},getLineForGesture:function(e,t){for(var s=0;s<e.length;s++)if(e[s].event===t||"click"===t&&!e[s].event)return e[s]},initMouseTracker:function(){this.own((0,g.Z)(m.Z.body(),"mousemove",v.Z.hitch(this,"onMouseMove")))},onMouseMove:function(e){var t=this.getCanvasMousePosition(e,!0);this._lastMousePos=t,this._lastMouseMoveEvent=e},destroy:function(){this.cleanUp()}},mounted:function(){}},G=U,I=s(1001),$=(0,I.Z)(G,c,d,!1,null,null,null),z=$.exports,j=s(76133),J=s(92751),K=s(99418),q=s(49161),X=s(768),Q=s(96722),Y=function(e){(0,K.Z)(s,e);var t=(0,q.Z)(s);function s(){var e;return(0,j.Z)(this,s),e=t.call(this),e.logger=new u.Z("ShareContoller"),e.logger.log(2,"constructor","exit"),e}return(0,J.Z)(s,[{key:"setCanvas",value:function(e){this.logger.log(3,"setCanvas","entry"),this._canvas=e}},{key:"setToolbar",value:function(e){this.logger.log(3,"setToolbar","entry"),this.toolbar=e}},{key:"setModelService",value:function(e){this.modelService=e}},{key:"setModelFactory",value:function(e){this.logger.log(3,"setModelFactory","entry"),this.factory=e}},{key:"setModel",value:function(e,t){this.logger.log(2,"setModel","entry > "+t),this.model=e;var s=this.countProps(e.screens);s>4&&this._canvas&&(this._canvas.zoom=.25,this._canvas.zoomLevelPos=2),this.inheritedModel=this.createInheritedModel(e),this.oldModel=v.Z.clone(e),this.render(t),this.toolbar?this.toolbar.setModel(e):console.debug("No toolbar in controller!"),this._canvas&&this._canvas.setFonts(e.fonts),this.logger.log(3,"setModel","entry > "+t)}},{key:"setMode",value:function(e){this.logger.log(0,"setMode","entry > "+e),this.toolbar&&this.toolbar.setMode(e),this._canvas.setMode(e)}},{key:"setSinglePage",value:function(e){this.logger.log(0,"setSinglePage","entry > "+e)}},{key:"getZoomFactor",value:function(){return this._canvas?this._canvas.getZoomFactor():1}},{key:"render",value:function(e){var t=this;if(this.logger.log(2,"render","enter > screenID : "+e),this._canvas){var s=Q.Z.createInheritedModel(this.model);requestAnimationFrame((function(){t._canvas.render(s),e&&t._canvas.moveToScreen(e)}))}}},{key:"_requestRendering",value:function(e){this._zoomedModel&&(this._canvas.render(this._zoomedModel),e&&this._canvas.moveToScreen(e)),this._zoomedModel=null}},{key:"_zoomToScreen",value:function(e){if(e&&this.model.screens[e]){var t=this.model.screens[e],s=h.Z.getBox(),i=s.w/t.w,o=s.h/t.h,n=Math.floor(10*Math.min(i,o))/10-.2;this._canvas.setZoom(n)}}},{key:"onWidgetSelected",value:function(e){this.logger.log(0,"onWidgetSelected","enter > "+e);var t=this.inheritedModel.widgets[e];t?this.toolbar&&this.toolbar.onWidgetSelected(t):console.warn("onWidgetSelected() > No width with id",e)}},{key:"onScreenSelected",value:function(e){this.logger.log(1,"onScreenSelected","enter > "+e);var t=this.model.screens[e];this.toolbar&&this.toolbar.onScreenSelected(t)}},{key:"onCanvasSelected",value:function(){this.logger.log(1,"onCanvasSelected","enter "),this.toolbar&&this.toolbar.onCanvasSelected()}},{key:"onLineSelected",value:function(e){this.logger.log(1,"onLineSelected","enter > "+e);var t=this.model.lines[e];this.toolbar&&this.toolbar.onLineSelected(t)}},{key:"onMultiSelect",value:function(e){this.logger.log(1,"onMultiSelect","enter > "),this.toolbar&&this.toolbar.onMultiSelect(e)}},{key:"onGroupSelected",value:function(e){if(this.logger.log(1,"onGroupSelected","enter > "+e),this.model.groups&&this.model.groups[e]&&this.toolbar){var t=this.model.groups[e];this.toolbar.onGroupSelect(t)}}},{key:"unSelect",value:function(){this._canvas&&this._canvas.unSelect(),this.toolbar&&this.toolbar.cleanUp()}},{key:"showSuccess",value:function(e){this._canvas&&this._canvas.showSuccess(e)}},{key:"showError",value:function(e){this._canvas&&this._canvas.showError(e)}}]),s}(X.Z),ee=s(24246),te=s(9723),se=s(77259),ie={name:"Design",mixins:[r.Z],data:function(){return{}},components:{ShareCanvas:z},computed:{pub:function(){return this.$route.meta&&this.$route.meta.isPublic},mode:function(){return this.pub?"public":"private"}},methods:{loadData:function(){var e=this,t=this.$route.query.h;this.logger.log(0,"loadData","enter",t),Promise.all([this.modelService.findAppByHash(t)]).then((function(t){e.buildCanvas(t[0])}))},buildCanvas:function(e){this.logger.log(0,"buildCanvas","enter");var t=this.$refs.canvas,s=new Y,i=this.modelService,o=new ee.Z;o.setModel(e);var n=new te.Z;n.setModel(e),n.setHash(this.$route.query.h),s.setModelService(i),s.setModelFactory(o),this.pub&&s.setPublic(!0),t.setController(s),t.setRenderFactory(n),t.setModelFactory(o),t.setModelService(i),t.setCommentService(se.Z.getCommentService()),t.setUser(this.user),t.setHash(this.$route.query.h);var a=null;for(var r in e.screens){var l=e.screens[r];if(l.props&&l.props.start){a=r;break}}s.setModel(e,a)}},mounted:function(){var e=this;return(0,a.Z)((0,n.Z)().mark((function t(){return(0,n.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.logger=new u.Z("Design"),l.Z.add(h.Z.body(),"MatcVisualEditor"),e.modelService=se.Z.getModelService(e.$route),t.next=5,se.Z.getUserService().load();case 5:e.user=t.sent,e.loadData(),e.logger.log(3,"mounted","exit");case 8:case"end":return t.stop()}}),t)})))()}},oe=ie,ne=(0,I.Z)(oe,i,o,!1,null,null,null),ae=ne.exports}}]);
//# sourceMappingURL=design-legacy.a4957a56.js.map